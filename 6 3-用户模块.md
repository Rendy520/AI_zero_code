---
created: 2025-12-29T15:52:22 (UTC +08:00)
tags: [,Java,Python,JavaScript,å‰ç«¯,Cè¯­è¨€,C++,Goè¯­è¨€,ç¨‹åºå‘˜,ç¼–ç¨‹å­¦ä¹ ,ITæ•™ç¨‹,è‡ªå­¦ç¼–ç¨‹,è½¯ä»¶å¼€å‘,é¡¹ç›®å®æˆ˜,ç¼–ç¨‹å¯¼èˆª,å¼€å‘è€…äº¤æµç¤¾åŒº,ç¼–ç¨‹èµ„æº,è®¡ç®—æœº]
source: https://www.codefather.cn/course/1948291549923344386/section/1950029618990997505
author: 
---

# 3 - ç”¨æˆ·æ¨¡å— - ã€å¤§å‚å¿…å¤‡ã€‘LangChain4j + å·¥ä½œæµ

> ## Excerpt
> æœ¬èŠ‚é‡ç‚¹ é¦–å…ˆå¼€å‘æ¯ä¸ªé¡¹ç›®åŸºæœ¬éƒ½å…·æœ‰çš„ç”¨æˆ·æ¨¡å—ï¼Œæœ¬èŠ‚æ•™ç¨‹å¯ä»¥å½“åšä¸€ä¸ª ç”¨æˆ·ç®¡ç†ç³»ç»Ÿé¡¹ç›® ç‹¬ç«‹å­¦ä¹ ï¼Œé€‚åˆæ–°æ‰‹å…¥é—¨ï¼Œåç«¯å’Œå‰ç«¯éƒ¨åˆ†ä¹Ÿå¯ä»¥æŒ‰éœ€ç‹¬ç«‹å­¦ä¹ ã€‚ æœ¬èŠ‚å¤§çº²ï¼š ç”¨æˆ·æ¨¡å—ã€‚ç¼–ç¨‹å¯¼èˆªæ•™ç¨‹åˆ†äº«ï¼Œåšæ‚¨ç¼–ç¨‹å­¦ä¹ è·¯ä¸Šçš„å¯¼èˆªå‘˜ã€‚

---
## æœ¬èŠ‚é‡ç‚¹

é¦–å…ˆå¼€å‘æ¯ä¸ªé¡¹ç›®åŸºæœ¬éƒ½å…·æœ‰çš„ç”¨æˆ·æ¨¡å—ï¼Œæœ¬èŠ‚æ•™ç¨‹å¯ä»¥å½“åšä¸€ä¸ª **ç”¨æˆ·ç®¡ç†ç³»ç»Ÿé¡¹ç›®** ç‹¬ç«‹å­¦ä¹ ï¼Œé€‚åˆæ–°æ‰‹å…¥é—¨ï¼Œåç«¯å’Œå‰ç«¯éƒ¨åˆ†ä¹Ÿå¯ä»¥æŒ‰éœ€ç‹¬ç«‹å­¦ä¹ ã€‚

æœ¬èŠ‚å¤§çº²ï¼šqo3wYiJtEuojZDmpW2HRDEwGWUH1DzVFQ47Zs4YmYuk=

-   ç”¨æˆ·æ¨¡å—éœ€æ±‚åˆ†æ
-   ç”¨æˆ·æ¨¡å—æ–¹æ¡ˆè®¾è®¡
-   ç”¨æˆ·æ¨¡å—åç«¯å¼€å‘ï¼ˆå« MyBatis Flex + ä»£ç ç”Ÿæˆå™¨ï¼‰
-   ç”¨æˆ·æ¨¡å—å‰ç«¯å¼€å‘ï¼ˆæ‰‹å†™ä¸ºä¸»ï¼Œä»…åŒ…å«ä¸€ç‚¹ Vibe Codingï¼‰

å‹æƒ…æç¤ºï¼Œé™¤äº†æ•°æ®è®¿é—®å±‚æ¡†æ¶ä½¿ç”¨ MyBatis Flexã€ä»¥åŠè‡ªå®šä¹‰äº†åç«¯ä»£ç ç”Ÿæˆå™¨ä¹‹å¤–ï¼Œæœ¬æœŸå†…å®¹å’Œ [ç¼–ç¨‹å¯¼èˆªçš„æ™ºèƒ½ååŒäº‘å›¾åº“é¡¹ç›®](https://www.codefather.cn/course/1864210260732116994) å¾ˆç›¸ä¼¼ï¼Œå¯ä»¥æŒ‰éœ€å­¦ä¹ ã€‚

## ä¸€ã€éœ€æ±‚åˆ†æ

å¯¹äºç”¨æˆ·æ¨¡å—ï¼Œé€šå¸¸è¦å…·æœ‰ä¸‹åˆ—åŠŸèƒ½ï¼š

-   ç”¨æˆ·æ³¨å†Œ
-   ç”¨æˆ·ç™»å½•
-   è·å–å½“å‰ç™»å½•ç”¨æˆ·
-   ç”¨æˆ·æ³¨é”€
-   ç”¨æˆ·æƒé™æ§åˆ¶
-   ã€ç®¡ç†å‘˜ã€‘ç®¡ç†ç”¨æˆ·

å…·ä½“åˆ†ææ¯ä¸ªéœ€æ±‚ï¼šdWCTYpHEFA/xV8BrvOpKRqkO1d88b9Ip8VkvBeLuZho=

1ï¼‰ç”¨æˆ·æ³¨å†Œï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥è´¦å·ã€å¯†ç ã€ç¡®è®¤å¯†ç è¿›è¡Œæ³¨å†Œ

2ï¼‰ç”¨æˆ·ç™»å½•ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥è´¦å·å’Œå¯†ç ç™»å½•

3ï¼‰è·å–å½“å‰ç™»å½•ç”¨æˆ·ï¼šå¾—åˆ°å½“â å‰å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡â æ¯ï¼ˆä¸ç”¨é‡å¤ç™»å½•ï¼‰nShO7+0zZStNyiJdnnoFDwT4JyyptzNsRjyXLsolAAU=

4ï¼‰ç”¨æˆ·æ³¨é”€ï¼šç”¨æˆ·å¯ä»¥é€€å‡ºç™»å½•

5ï¼‰ç”¨æˆ·æƒé™æ§åˆ¶ï¼šç”¨æˆ·åˆåˆ†ä¸ºâ æ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜ï¼Œâ ç®¡ç†å‘˜æ‹¥æœ‰æ•´ä¸ªç³»ç»Ÿçš„æœ€é«˜æƒé™ï¼Œæ¯”å¦‚å¯ä»¥ç®¡ç†å…¶ä»–ç”¨æˆ·

6ï¼‰ç”¨æˆ·ç®¡ç†ï¼šä»…ç®¡ç†å‘˜å¯ç”¨ï¼Œâ å¯ä»¥å¯¹æ•´ä¸ªç³»ç»Ÿä¸­çš„â ç”¨æˆ·è¿›è¡Œç®¡ç†ï¼Œæ¯”å¦‚æœç´¢ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·1vM0bC71h2RCfUkazMGszlP9tIpAZTvdkFrdc8O6/+w=

## äºŒã€æ–¹æ¡ˆè®¾è®¡

å®ç°ç”¨æˆ·æ¨¡å—çš„éš¾åº¦ä¸å¤§ï¼Œæ–¹æ¡ˆè®¾è®¡é˜¶æ®µæˆ‘ä»¬éœ€è¦ç¡®è®¤ï¼š

-   åº“è¡¨è®¾è®¡
-   ç”¨æˆ·ç™»å½•æµç¨‹
-   å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ

### åº“è¡¨è®¾è®¡

åº“åï¼šyu\_ai\_code\_mother

è¡¨åï¼šuserï¼ˆç”¨æˆ·è¡¨ï¼‰p+CfRPZxNEuU7hG8dzfPcN4R10eC9eypGHmTaRf/x7c=

é±¼çš®ä¼šå…ˆè®²æœ¬é¡¹ç›®éœ€è¦çš„æ ¸å¿ƒè®¾â è®¡ï¼Œå†è¡¥å……ä¸€äº›æ‰©å±•â è®¾è®¡ï¼Œä¾¿äºå¤§å®¶å­¦ä¹ ã€‚

#### 1ã€æ ¸å¿ƒè®¾è®¡

ç”¨æˆ·è¡¨çš„æ ¸å¿ƒæ˜¯ç”¨æˆ·ç™»å½•å‡­è¯ï¼ˆâ è´¦å·å¯†ç ï¼‰å’Œä¸ªäººä¿¡â æ¯ï¼ŒSQL å¦‚ä¸‹ï¼šEVevk6+j/BC/ssKO5aUZF8Rusnkp1o/HghJkPkRChGQ=

```sql
-- ç”¨æˆ·è¡¨
create table if not exists user
(
    id           bigint auto_increment comment 'id' primary key,
    userAccount  varchar(256)                           not null comment 'è´¦å·',
    userPassword varchar(512)                           not null comment 'å¯†ç ',
    userName     varchar(256)                           null comment 'ç”¨æˆ·æ˜µç§°',
    userAvatar   varchar(1024)                          null comment 'ç”¨æˆ·å¤´åƒ',
    userProfile  varchar(512)                           null comment 'ç”¨æˆ·ç®€ä»‹',
    userRole     varchar(256) default 'user'            not null comment 'ç”¨æˆ·è§’è‰²ï¼šuser/admin',
    editTime     datetime     default CURRENT_TIMESTAMP not null comment 'ç¼–è¾‘æ—¶é—´',
    createTime   datetime     default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime   datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete     tinyint      default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    UNIQUE KEY uk_userAccount (userAccount),
    INDEX idx_userName (userName)
) comment 'ç”¨æˆ·' collate = utf8mb4_unicode_ci;
```

å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š

1.  editTime å’Œ updateTime çš„åŒºåˆ«ï¼šeditTime è¡¨ç¤ºç”¨æˆ·ç¼–è¾‘ä¸ªäººä¿¡æ¯çš„æ—¶é—´ï¼ˆéœ€è¦ä¸šåŠ¡ä»£ç æ¥æ›´æ–°ï¼‰ï¼Œè€Œ updateTime è¡¨ç¤ºè¿™æ¡ç”¨æˆ·è®°å½•ä»»ä½•å­—æ®µå‘ç”Ÿä¿®æ”¹çš„æ—¶é—´ï¼ˆç”±æ•°æ®åº“è‡ªåŠ¨æ›´æ–°ï¼‰ã€‚
2.  ç»™å”¯ä¸€å€¼æ·»åŠ å”¯ä¸€é”®ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ï¼Œæ¯”å¦‚è´¦å· userAccountï¼Œåˆ©ç”¨æ•°æ®åº“å¤©ç„¶é˜²é‡å¤ï¼ŒåŒæ—¶å¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ã€‚
3.  ç»™ç»å¸¸ç”¨äºæŸ¥è¯¢çš„å­—æ®µæ·»åŠ ç´¢å¼•ï¼Œæ¯”å¦‚ç”¨æˆ·æ˜µç§° userNameï¼Œå¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ã€‚

ğŸ’¡ å»ºè®®å…»æˆå¥½ä¹ æƒ¯ï¼Œå°†åº“è¡¨è®¾è®¡ SQL ä¿å­˜åˆ°é¡¹ç›®çš„ç›®å½•ä¸­ï¼Œæ¯”å¦‚æ–°å»º `sql/create_table.sql` æ–‡ä»¶ï¼Œè¿™æ ·å…¶ä»–å¼€å‘è€…å°±èƒ½æ›´å¿«åœ°äº†è§£å’Œå¯åŠ¨é¡¹ç›®ã€‚

```sql
# æ•°æ®åº“åˆå§‹åŒ–
# @author <a href="https://github.com/liyupi">ç¨‹åºå‘˜é±¼çš®</a>
# @from <a href="https://codefather.cn">ç¼–ç¨‹å¯¼èˆªå­¦ä¹ åœˆ</a>

-- åˆ›å»ºåº“
create database if not exists yu_ai_code_mother;

-- åˆ‡æ¢åº“
use yu_ai_code_mother;

-- ç”¨æˆ·è¡¨
-- ä»¥ä¸‹æ˜¯å»ºè¡¨è¯­å¥
```

#### 2ã€æ‰©å±•è®¾è®¡

1ï¼‰å¦‚æœè¦å®ç°ä¼šå‘˜åŠŸèƒ½ï¼Œå¯ä»¥å¯¹è¡¨è¿›è¡Œå¦‚ä¸‹æ‰©å±•ï¼š

1.  ç»™ userRole å­—æ®µæ–°å¢æšä¸¾å€¼ `vip`ï¼Œè¡¨ç¤ºä¼šå‘˜ç”¨æˆ·ï¼Œå¯æ ¹æ®è¯¥å€¼åˆ¤æ–­ç”¨æˆ·æƒé™
2.  æ–°å¢ä¼šå‘˜è¿‡æœŸæ—¶é—´å­—æ®µï¼Œå¯ç”¨äºè®°å½•ä¼šå‘˜æœ‰æ•ˆæœŸ
3.  æ–°å¢ä¼šå‘˜å…‘æ¢ç å­—æ®µï¼Œå¯ç”¨äºè®°å½•ä¼šå‘˜çš„å¼€é€šæ–¹å¼
4.  æ–°å¢ä¼šå‘˜ç¼–å·å­—æ®µï¼Œå¯ä¾¿äºå®šä½ç”¨æˆ·å¹¶æä¾›é¢å¤–æœåŠ¡ï¼Œå¹¶å¢åŠ ä¼šå‘˜å½’å±æ„Ÿ

å¯¹åº”çš„ SQL å¦‚ä¸‹ï¼šWBpr9WI72APgOj+DCCZKObs+ofP0VhBHSvqSELGriv0=

```sql
vipExpireTime datetime     null comment 'ä¼šå‘˜è¿‡æœŸæ—¶é—´',
vipCode       varchar(128) null comment 'ä¼šå‘˜å…‘æ¢ç ',
vipNumber     bigint       null comment 'ä¼šå‘˜ç¼–å·'
```

2ï¼‰å¦‚æœè¦å®ç°ç”¨æˆ·é‚€è¯·åŠŸèƒ½ï¼Œå¯ä»¥å¯¹è¡¨è¿›è¡Œå¦‚ä¸‹æ‰©å±•ï¼š

1.  æ–°å¢ shareCode åˆ†äº«ç å­—æ®µï¼Œç”¨äºè®°å½•æ¯ä¸ªç”¨æˆ·çš„å”¯ä¸€é‚€è¯·æ ‡è¯†ï¼Œå¯æ‹¼æ¥åˆ°é‚€è¯·ç½‘å€åé¢ï¼Œæ¯”å¦‚ [https://mianshiya.com/?shareCode=xxx](https://mianshiya.com/?shareCode=xxx)
2.  æ–°å¢ inviteUser å­—æ®µï¼Œç”¨äºè®°å½•è¯¥ç”¨æˆ·è¢«å“ªä¸ªç”¨æˆ·é‚€è¯·äº†ï¼Œå¯é€šè¿‡è¿™ä¸ªå­—æ®µæŸ¥è¯¢æŸç”¨æˆ·é‚€è¯·çš„ç”¨æˆ·åˆ—è¡¨ã€‚

å¯¹åº”çš„ SQL å¦‚ä¸‹ï¼š

```sql
shareCode     varchar(20)  DEFAULT NULL COMMENT 'åˆ†äº«ç ',
inviteUser    bigint       DEFAULT NULL COMMENT 'é‚€è¯·ç”¨æˆ· id'
```

### ç”¨æˆ·ç™»å½•æµç¨‹

1ï¼‰å»ºç«‹åˆå§‹ä¼šè¯ï¼šå‰ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼ŒæœåŠ¡å™¨â ä¼šä¸ºè¯¥å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªåˆå§‹çš„åŒ¿å â Sessionï¼Œå¹¶å°†å…¶çŠ¶æ€ä¿å­˜ä¸‹æ¥ã€‚è¿™ä¸ª Session çš„ ID ä¼šä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œè¿”å›ç»™å‰ç«¯ã€‚

2ï¼‰ç™»å½•æˆåŠŸï¼Œæ›´æ–°ä¼šè¯ä¿¡æ¯ï¼šå½“ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥æ­£ç¡®çš„è´¦å·å¯†ç å¹¶æäº¤åˆ°åç«¯éªŒè¯æˆåŠŸåï¼Œåç«¯ä¼šâ æ›´æ–°è¯¥ç”¨æˆ·çš„ Sessionï¼Œå°†ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ· Iâ Dã€ç”¨æˆ·åç­‰ï¼‰ä¿å­˜åˆ°ä¸è¯¥ Session å…³è”çš„å­˜å‚¨ä¸­ã€‚åŒæ—¶ï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ª Set-Cookie çš„å“åº”å¤´ï¼ŒæŒ‡ç¤ºå‰ç«¯ä¿å­˜è¯¥ç”¨æˆ·çš„ Session IDã€‚

3ï¼‰å‰ç«¯ä¿å­˜ Cookieï¼šå‰ç«¯æ¥æ”¶åˆ°åç«¯çš„å“åº”â åï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ ¹æ® Set-Câ ookie æŒ‡ä»¤ï¼Œå°† Session ID å­˜å‚¨åˆ°æµè§ˆå™¨çš„ Cookie ä¸­ï¼Œä¸è¯¥åŸŸåç»‘å®šã€‚EVevk6+j/BC/ssKO5aUZF8Rusnkp1o/HghJkPkRChGQ=

4ï¼‰å¸¦ Cookie çš„åç»­è¯·æ±‚ï¼šå½“å‰ç«¯å†â æ¬¡å‘ç›¸åŒåŸŸåçš„æœåŠ¡å™¨å‘é€è¯·æ±‚â æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚å¤´ä¸­é™„å¸¦ä¹‹å‰ä¿å­˜çš„ Cookieï¼Œå…¶ä¸­åŒ…å« Session IDã€‚

5ï¼‰åç«¯éªŒè¯ä¼šè¯ï¼šæœåŠ¡å™¨æ¥æ”¶åˆ°â è¯·æ±‚åï¼Œä»è¯·æ±‚å¤´ä¸­æâ å– Session IDï¼Œæ‰¾åˆ°å¯¹åº”çš„ Session æ•°æ®ã€‚

6ï¼‰è·å–ä¼šè¯ä¸­å­˜å‚¨çš„ä¿¡æ¯ï¼šåç«¯é€šè¿‡è¯¥â  Session è·å–ä¹‹â å‰å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚ç™»å½•åã€æƒé™ç­‰ï¼‰ï¼Œä»è€Œè¯†åˆ«ç”¨æˆ·èº«ä»½å¹¶æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚nShO7+0zZStNyiJdnnoFDwT4JyyptzNsRjyXLsolAAU=

![](https://www.codefather.cn/_next/static/media/defaultCode.6873fc9a.png)

### å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ

å¯ä»¥å°†æ¥å£åˆ†ä¸º 4 ç§æƒé™ï¼šqo3wYiJtEuojZDmpW2HRDEwGWUH1DzVFQ47Zs4YmYuk=

1.  æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨
2.  ç™»å½•ç”¨æˆ·æ‰èƒ½ä½¿ç”¨
3.  æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ç™»å½•ç”¨æˆ·èƒ½è¿›è¡Œæ›´å¤šæ“ä½œï¼ˆæ¯”å¦‚ç™»å½•åæŸ¥çœ‹å…¨æ–‡ï¼‰
4.  ä»…ç®¡ç†å‘˜æ‰èƒ½ä½¿ç”¨

ä¼ ç»Ÿçš„æƒé™æ§åˆ¶æ–¹æ³•æ˜¯ï¼Œåœ¨æ¯ä¸ªâ æ¥å£å†…å•ç‹¬ç¼–å†™é€»è¾‘â ï¼šå…ˆè·å–åˆ°å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶ååˆ¤æ–­ç”¨æˆ·çš„æƒé™æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚

è¿™ç§æ–¹æ³•æœ€çµæ´»ï¼Œä½†æ˜¯ä¼šå†™å¾ˆå¤šâ é‡å¤çš„ä»£ç ï¼Œè€Œä¸”å…¶â ä»–å¼€å‘è€…æ— æ³•ä¸€çœ¼å¾—çŸ¥æ¥å£æ‰€éœ€è¦çš„æƒé™ã€‚EVevk6+j/BC/ssKO5aUZF8Rusnkp1o/HghJkPkRChGQ=

æƒé™æ ¡éªŒå…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸€èˆ¬ä¼šé€šè¿‡ **Spring AOP åˆ‡é¢ + è‡ªå®šä¹‰æƒé™æ ¡éªŒæ³¨è§£** å®ç°ç»Ÿä¸€çš„æ¥å£æ‹¦æˆªå’Œæƒé™æ ¡éªŒï¼›å¦‚æœæœ‰ç‰¹æ®Šçš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå†å•ç‹¬åœ¨æ¥å£ä¸­ç¼–ç ã€‚

ğŸ’¡ å¦‚æœéœ€è¦æ›´å¤æ‚æ›´çµæ´»çš„æƒé™æ§åˆ¶ï¼Œå¯ä»¥å¼•å…¥ Shiro / Spring Security / Sa-Token ç­‰ä¸“é—¨çš„æƒé™ç®¡ç†æ¡†æ¶ã€‚åœ¨ [ç¼–ç¨‹å¯¼èˆªçš„æ™ºèƒ½ååŒäº‘å›¾åº“é¡¹ç›®](https://www.codefather.cn/course/1864210260732116994) ä¸­ï¼Œæœ‰ Sa-Token æƒé™ç®¡ç†çš„å®æˆ˜ã€‚

___

OKï¼Œæœ‰äº†å®ç°æ–¹æ¡ˆåï¼Œæˆ‘ä»¬å…ˆæ¥å¼€å‘åç«¯æ¥å£ã€‚

## åç«¯å¼€å‘

ä»¥åæ¯æ¬¡å¼€å‘ä¸€å¥—æ–°æ¥å£æ—¶ï¼Œéƒ½å¯ä»¥éµå¾ªä»¥ä¸‹æµç¨‹ã€‚1vM0bC71h2RCfUkazMGszlP9tIpAZTvdkFrdc8O6/+w=

### æ•°æ®åº“å»ºè¡¨

éœ€è¦åœ¨æœ¬åœ°å¯åŠ¨ MySQLï¼ˆâ æ¨è 8.x ç‰ˆæœ¬â ï¼‰ï¼Œåˆ©ç”¨ IDEA è¿æ¥ MySQL æ•°æ®åº“ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/o0a0G8OvLr5CCeoi.webp)p+CfRPZxNEuU7hG8dzfPcN4R10eC9eypGHmTaRf/x7c=

å¡«å†™é…ç½®å¹¶æ£€æµ‹è¿æ¥ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/NfJeiYevOgy6LZHr.webp)

æ‰§è¡Œ SQL è„šæœ¬ï¼Œåˆ›å»ºæ•°æ®åº“è¡¨ï¼šF+kzRHG1248BgN91hBPqtNxbML3nLzvb0nw4jU7NTyI=

![](https://pic.code-nav.cn/course_picture/1608440217629360130/IX3gKVsn2JuFtZRi.webp)

### MyBatis Flex ä»£ç ç”Ÿæˆå™¨

#### 1ã€ä»€ä¹ˆæ˜¯ MyBatis Flexï¼Ÿ

ä¹‹å‰ç¼–ç¨‹å¯¼èˆªçš„å¾ˆå¤šé¡¹ç›®ä¸­ï¼Œé±¼çš®éƒ½æ˜¯ä½¿ç”¨ [MyBatis Plus](https://baomidou.com/) ä½œä¸ºæ•°æ®è®¿é—®å±‚æ¡†æ¶ï¼Œèƒ½å¤Ÿé€šè¿‡ Java å¿«é€Ÿæ“ä½œæ•°æ®åº“ã€‚

ä¸ºäº†å¸®å¤§å®¶ä¸°å¯ŒæŠ€æœ¯æ ˆï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥å­¦ä¸€ä¸ªæ–°çš„æ•°æ®è®¿é—®å±‚æ¡†æ¶ [MyBatis Flex](https://mybatis-flex.com/)ï¼Œå®ƒçš„ä½œç”¨å’Œ MyBatis Plus ä¸€æ ·ï¼Œéƒ½æ˜¯å¯¹ä¼ ç»Ÿæ“ä½œæ•°æ®åº“çš„ MyBatis æ¡†æ¶è¿›è¡Œå¢å¼ºã€‚å®ƒçš„ 3 å¤§ä¼˜åŠ¿ï¼š

-   æ›´è½»é‡ï¼šMyBatis-Flex é™¤äº† MyBatis æœ¬èº«ï¼Œå†æ— ä»»ä½•ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œå› æ­¤ä¼šå¸¦æ¥æ›´é«˜çš„è‡ªä¸»æ€§ã€æŠŠæ§æ€§å’Œç¨³å®šæ€§ã€‚åœ¨ä»»ä½•ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œä¾èµ–è¶Šå¤šï¼Œç¨³å®šæ€§è¶Šå·®ã€‚
-   æ›´çµæ´»ï¼šMyBatis-Flex æä¾›äº†éå¸¸çµæ´»çš„ QueryWrapperï¼Œæ”¯æŒå…³è”æŸ¥è¯¢ã€å¤šè¡¨æŸ¥è¯¢ã€å¤šä¸»é”®ã€é€»è¾‘åˆ é™¤ã€ä¹è§‚é”æ›´æ–°ã€æ•°æ®å¡«å……ã€æ•°æ®è„±æ•ç­‰ç­‰ã€‚
-   æ›´é«˜çš„æ€§èƒ½ï¼šMyBatis-Flex é€šè¿‡ç‹¬ç‰¹çš„æ¶æ„ï¼Œæ²¡æœ‰ä»»ä½• MyBatis æ‹¦æˆªå™¨ã€åœ¨ SQL æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰ä»»ä½•çš„ SQL Parseï¼Œå› æ­¤ä¼šå¸¦æ¥æŒ‡æ•°çº§çš„æ€§èƒ½å¢é•¿ã€‚

[å®˜æ–¹æ–‡æ¡£](https://mybatis-flex.com/zh/intro/comparison.html) ä¸­æåˆ°äº†å’Œ MyBatis Plus çš„åŠŸèƒ½å¯¹æ¯”ï¼Œæˆ‘è®¤ä¸ºæ¯”è¾ƒæœ‰ç«äº‰åŠ›çš„æ˜¯å®ƒ **æ”¯æŒå¤šè¡¨æŸ¥è¯¢**ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/KPD0FCEeEEFTO6ln.webp)

æ­¤å¤–ï¼Œåœ¨ Mybatis Flex ä¸­ï¼Œæœ‰äº†ä¸€ä¸ªåç§°ä¸º `mybatis-flex-codegen` çš„æ¨¡å—ï¼Œæä¾›äº†å¯ä»¥é€šè¿‡æ•°æ®åº“è¡¨ï¼Œç”Ÿæˆä»£ç çš„åŠŸèƒ½ã€‚å½“æˆ‘ä»¬æŠŠæ•°æ®åº“è¡¨è®¾è®¡å®Œæˆåï¼Œ å°±å¯ä»¥ä½¿ç”¨å…¶å¿«é€Ÿç”Ÿæˆ Entityã€Mapperã€Serviceã€Controller ä»£ç ï¼Œèƒ½å¤§å¹…æé«˜æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚dWCTYpHEFA/xV8BrvOpKRqkO1d88b9Ip8VkvBeLuZho=

#### 2ã€ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨

ä¸‹é¢è®©æˆ‘ä»¬å‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://mybatis-flex.com/zh/others/codegen.html) ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨ã€‚

1ï¼‰å¼•å…¥ MyBatis Fâ lex ä¾èµ–ï¼Œæ³¨æ„â æ˜¯ Spring Boot3 çš„ï¼šcZq9/nGwbRXl38gxWuOGAJfnulyo9Sx2vt9GhAJuMwQ=

```xml
<dependency>
    <groupId>com.mybatis-flex</groupId>
    <artifactId>mybatis-flex-spring-boot3-starter</artifactId>
    <version>1.11.0</version>
</dependency>
```

è¿˜éœ€è¦å¼•å…¥ä»£ç ç”Ÿæˆç›¸å…³ä¾èµ–ï¼š

```xml
<!-- ä»£ç ç”Ÿæˆæ¨¡å— -->
<dependency>
    <groupId>com.mybatis-flex</groupId>
    <artifactId>mybatis-flex-codegen</artifactId>
    <version>1.11.0</version>
</dependency>
<!-- æ•°æ®åº“è¿æ¥æ±  -->
<dependency>
    <groupId>com.zaxxer</groupId>
    <artifactId>HikariCP</artifactId>
</dependency>
```

2ï¼‰ç¼–å†™æ•°æ®åº“è¿æ¥é…ç½®ï¼š

```yaml
spring:
  # mysql
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/yu_ai_code_mother
    username: root
    password: 123456
```

3ï¼‰å¼€å‘ç”Ÿæˆå™¨F+kzRHG1248BgN91hBPqtNxbML3nLzvb0nw4jU7NTyI=

åœ¨æ ¹åŒ…ä¸‹æ–°å»º generator åŒ…ï¼Œæ–°â å»º MyBatisCodeâ Generator ç±»ï¼Œç¼–å†™ä»£ç ç”Ÿæˆå™¨ã€‚å…ˆä»å®˜æ–¹å¤åˆ¶ç¤ºä¾‹ä»£ç ï¼Œç„¶åæŒ‰éœ€ä¿®æ”¹å³å¯ã€‚

åœ¨ Mybatis Flex â çš„ä»£ç ç”Ÿæˆå™¨ä¸­ï¼Œæ”¯æŒâ å¦‚ä¸‹ 8 ç§ç±»å‹çš„çš„äº§ç‰©ç”Ÿæˆï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨å‰ 6 ä¸ªå°±å¥½ï¼š

-   Entity å®ä½“ç±» âœ…
-   Mapper æ˜ å°„ç±» âœ…
-   Service æœåŠ¡ç±» âœ…
-   ServiceImpl æœåŠ¡å®ç°ç±» âœ…
-   Controller æ§åˆ¶ç±» âœ…
-   MapperXml æ–‡ä»¶ âœ…
-   TableDef è¡¨å®šä¹‰è¾…åŠ©ç±»
-   package-info.java æ–‡ä»¶

ä»£ç å¦‚ä¸‹ï¼š

```java
public class MyBatisCodeGenerator {

    // éœ€è¦ç”Ÿæˆçš„è¡¨å
    private static final String[] TABLE_NAMES = {"user"};

    public static void main(String[] args) {
        // è·å–æ•°æ®æºä¿¡æ¯
        Dict dict = YamlUtil.loadByPath("application.yml");
        Map<String, Object> dataSourceConfig = dict.getByPath("spring.datasource");
        String url = String.valueOf(dataSourceConfig.get("url"));
        String username = String.valueOf(dataSourceConfig.get("username"));
        String password = String.valueOf(dataSourceConfig.get("password"));
        // é…ç½®æ•°æ®æº
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl(url);
        dataSource.setUsername(username);
        dataSource.setPassword(password);

        // åˆ›å»ºé…ç½®å†…å®¹
        GlobalConfig globalConfig = createGlobalConfig();

        // é€šè¿‡ datasource å’Œ globalConfig åˆ›å»ºä»£ç ç”Ÿæˆå™¨
        Generator generator = new Generator(dataSource, globalConfig);

        // ç”Ÿæˆä»£ç 
        generator.generate();
    }

    // è¯¦ç»†é…ç½®è§ï¼šhttps://mybatis-flex.com/zh/others/codegen.html
    public static GlobalConfig createGlobalConfig() {
        // åˆ›å»ºé…ç½®å†…å®¹
        GlobalConfig globalConfig = new GlobalConfig();

        // è®¾ç½®æ ¹åŒ…ï¼Œå»ºè®®å…ˆç”Ÿæˆåˆ°ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸‹ï¼Œç”Ÿæˆä»£ç åï¼Œå†ç§»åŠ¨åˆ°é¡¹ç›®ç›®å½•ä¸‹
        globalConfig.getPackageConfig()
                .setBasePackage("com.yupi.yuaicodemother.genresult");

        // è®¾ç½®è¡¨å‰ç¼€å’Œåªç”Ÿæˆå“ªäº›è¡¨ï¼ŒsetGenerateTable æœªé…ç½®æ—¶ï¼Œç”Ÿæˆæ‰€æœ‰è¡¨
        globalConfig.getStrategyConfig()
                .setGenerateTable(TABLE_NAMES)
                // è®¾ç½®é€»è¾‘åˆ é™¤çš„é»˜è®¤å­—æ®µåç§°
                .setLogicDeleteColumn("isDelete");

        // è®¾ç½®ç”Ÿæˆ entity å¹¶å¯ç”¨ Lombok
        globalConfig.enableEntity()
                .setWithLombok(true)
                .setJdkVersion(21);

        // è®¾ç½®ç”Ÿæˆ mapper
        globalConfig.enableMapper();
        globalConfig.enableMapperXml();

        // è®¾ç½®ç”Ÿæˆ service
        globalConfig.enableService();
        globalConfig.enableServiceImpl();

        // è®¾ç½®ç”Ÿæˆ controller
        globalConfig.enableController();

        // è®¾ç½®ç”Ÿæˆæ—¶é—´å’Œå­—ç¬¦ä¸²ä¸ºç©ºï¼Œé¿å…å¤šä½™çš„ä»£ç æ”¹åŠ¨
        globalConfig.getJavadocConfig()
                .setAuthor("<a href=\"https://github.com/liyupi\">ç¨‹åºå‘˜é±¼çš®</a>")
                .setSince("");
        return globalConfig;
    }
}
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä»é…ç½®æ–‡ä»¶ä¸­â è·å–æ•°æ®åº“è¿æ¥ä¿¡æ¯â ï¼Œç”¨æ¥åˆå§‹åŒ–æ•°æ®æºã€‚ç„¶åè‡ªå®šä¹‰äº†ä¸€äº›ç”Ÿæˆé…ç½®ï¼ŒåŒ…æ‹¬ï¼šqo3wYiJtEuojZDmpW2HRDEwGWUH1DzVFQ47Zs4YmYuk=

-   æŒ‡å®šé€»è¾‘åˆ é™¤å­—æ®µ
-   ä½¿ç”¨çš„ JDK ç‰ˆæœ¬
-   ç”Ÿæˆçš„ä»£ç æ”¾åˆ°å“ªä¸ªåŒ…ï¼ˆå»ºè®®é€‰æ‹©ä¸€ä¸ªç‹¬ç«‹çš„åŒ…ï¼Œä¸è¦è·Ÿè€ä»£ç æ··ä¸€èµ·ï¼‰
-   è¦ç”Ÿæˆå“ªäº›æ–‡ä»¶
-   ç”Ÿæˆä»€ä¹ˆä»£ç æ³¨é‡Š

4ï¼‰æ‰§è¡Œä»£ç ç”Ÿæˆå™¨ï¼ŒæŸ¥çœ‹ç”Ÿæˆçš„ç»“æœã€‚å¦‚å›¾ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/7wixXJfNrEPODvjF.webp)EVevk6+j/BC/ssKO5aUZF8Rusnkp1o/HghJkPkRChGQ=

å°†ç”Ÿæˆçš„ä»£ç æ–‡ä»¶ç§»åŠ¨åˆ°å¯¹åº”çš„åŒ…ä¸‹ï¼Œç§»åŠ¨åï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/5DRXQwwLlp1PdpCB.webp)

5ï¼‰ä¸»ç±»æ·»åŠ æ‰«æ Mapper æ–‡ä»¶çš„æ³¨è§£ï¼šp+CfRPZxNEuU7hG8dzfPcN4R10eC9eypGHmTaRf/x7c=

```java
@SpringBootApplication
@MapperScan("com.yupi.yuaicodemother.mapper")
public class YuAiCodeMotherApplication {
    public static void main(String[] args) {
        SpringApplication.run(YuAiCodeMotherApplication.class, args);
    }
}
```

ç„¶åå°±å¯ä»¥å¯åŠ¨é¡¹ç›®ï¼ŒéªŒè¯ç”Ÿæˆä»£ç çš„æ•ˆæœäº†ã€‚

#### æ‰©å±•æ€è·¯ - è‡ªå®šä¹‰ä»£ç ç”Ÿæˆ

å¯ä»¥å‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://mybatis-flex.com/zh/others/codegen.html)ï¼Œé€šè¿‡è‡ªå®šä¹‰æ¨¡æ¿çš„æ–¹å¼æ›´çµæ´»åœ°æ§åˆ¶ä»£ç ç”Ÿæˆçš„å†…å®¹ï¼Œæ¯”å¦‚è®¾ç½®ä¸»é”®è‡ªå¢ç­–ç•¥ã€å¢åŠ  Controller å±‚ç”Ÿæˆçš„æ¥å£ç­‰ç­‰ã€‚

### æ•°æ®æ¨¡å‹å¼€å‘

#### 1ã€å®ä½“ç±»

ç”Ÿæˆçš„ä»£ç ä¹Ÿè®¸ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘â ä»¬çš„è¦æ±‚ï¼Œæ¯”å¦‚æ•°æ®â åº“å®ä½“ç±»ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ›´æ”¹å…¶å­—æ®µé…ç½®ï¼ŒæŒ‡å®šä¸»é”®ç”Ÿæˆç­–ç•¥ã€‚

id é»˜è®¤æ˜¯è¿ç»­ç”Ÿæˆçš„ï¼Œå®¹æ˜“è¢«çˆ¬è™«æŠ“å–ï¼Œæ‰€ä»¥æ›´æ¢ç­–ç•¥ä¸º `ASSIGN_ID` é›ªèŠ±ç®—æ³•ç”Ÿæˆã€‚

ä¿®æ”¹ User ç±»çš„ä»£ç å¦‚ä¸‹ï¼šp+CfRPZxNEuU7hG8dzfPcN4R10eC9eypGHmTaRf/x7c=

```java
@Table("user")
public class User implements Serializable {

    @Id(keyType = KeyType.Generator, value = KeyGenerators.snowFlakeId)
    private Long id;
}
```

ğŸ’¡ ä½¿ç”¨æ¡†æ¶çš„è¿‡ç¨‹ä¸­æœ‰ä»»ä½•ç–‘é—®ï¼Œéƒ½å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£æŸ¥é˜…ï¼Œæ¯”å¦‚ [äº†è§£ MyBatis Flex çš„ä¸»é”®æ³¨è§£](https://mybatis-flex.com/zh/core/id.html)ã€‚

#### 2ã€æšä¸¾ç±»

å¯¹äºç”¨æˆ·è§’è‰²è¿™æ ·å€¼çš„æ•°é‡æœ‰é™çš„â ã€å¯æšä¸¾çš„å­—æ®µï¼Œæœ€å¥½â å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œä¾¿äºåœ¨é¡¹ç›®ä¸­è·å–å€¼ã€å‡å°‘æšä¸¾å€¼è¾“å…¥é”™è¯¯çš„æƒ…å†µã€‚

åœ¨ `model.enums` åŒ…ä¸‹æ–°å»º UserRoleEnumï¼š

```java
@Getter
public enum UserRoleEnum {

    USER("ç”¨æˆ·", "user"),
    ADMIN("ç®¡ç†å‘˜", "admin");

    private final String text;

    private final String value;

    UserRoleEnum(String text, String value) {
        this.text = text;
        this.value = value;
    }

    /**
     * æ ¹æ® value è·å–æšä¸¾
     *
     * @param value æšä¸¾å€¼çš„value
     * @return æšä¸¾å€¼
     */
    public static UserRoleEnum getEnumByValue(String value) {
        if (ObjUtil.isEmpty(value)) {
            return null;
        }
        for (UserRoleEnum anEnum : UserRoleEnum.values()) {
            if (anEnum.value.equals(value)) {
                return anEnum;
            }
        }
        return null;
    }
}
```

å…¶ä¸­ï¼ŒgetEnumByVaâ lue æ˜¯é€šè¿‡ vâ alue æ‰¾åˆ°å…·ä½“çš„æšä¸¾å¯¹è±¡ã€‚

ğŸ’¡ å¦‚æœæšä¸¾å€¼ç‰¹åˆ«å¤šï¼Œå¯ä»¥â  Map ç¼“å­˜æ‰€æœ‰â æšä¸¾å€¼æ¥åŠ é€ŸæŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯éå†åˆ—è¡¨ã€‚

___

ä¸‹é¢ä¾æ¬¡è¿›è¡Œå„åŠŸèƒ½æ¥å£çš„å¼€å‘ã€‚

### ç”¨æˆ·æ³¨å†Œ

#### 1ã€æ•°æ®æ¨¡å‹

åœ¨ `model.dto.user` ä¸‹æ–°å»ºç”¨äºæ¥å—è¯·æ±‚å‚æ•°çš„ç±»ï¼š

```java
@Data
public class UserRegisterRequest implements Serializable {

    private static final long serialVersionUID = 3191241716373120793L;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * å¯†ç 
     */
    private String userPassword;

    /**
     * ç¡®è®¤å¯†ç 
     */
    private String checkPassword;
}
```

ğŸ’¡ åœ¨ Java æ¥å£å¼€å‘ä¸­ï¼Œä¸ºæ¯ä¸ªæ¥å£å®šä¹‰ä¸€ä¸ªä¸“é—¨çš„ç±»æ¥â æ¥æ”¶è¯·æ±‚å‚æ•°ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤â æ€§ï¼Œä¾¿äºå¯¹å‚æ•°è¿›è¡Œç»Ÿä¸€éªŒè¯å’Œæ‰©å±•ï¼ŒåŒæ—¶å‡å°‘æ¥å£æ–¹æ³•å‚æ•°è¿‡å¤šå¯¼è‡´çš„å¤æ‚æ€§ï¼Œæœ‰åŠ©äºåœ¨å¤æ‚åœºæ™¯ä¸‹æ›´æ¸…æ™°åœ°ç®¡ç†å’Œä¼ é€’æ•°æ®ã€‚qo3wYiJtEuojZDmpW2HRDEwGWUH1DzVFQ47Zs4YmYuk=

#### 2ã€æœåŠ¡å¼€å‘

åœ¨ `service` åŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼š

```java
/**
 * ç”¨æˆ·æ³¨å†Œ
 *
 * @param userAccount   ç”¨æˆ·è´¦æˆ·
 * @param userPassword  ç”¨æˆ·å¯†ç 
 * @param checkPassword æ ¡éªŒå¯†ç 
 * @return æ–°ç”¨æˆ· id
 */
long userRegister(String userAccount, String userPassword, String checkPassword);
```

åœ¨ UserServiceIâ mpl ä¸­å¢åŠ å®ç°â ä»£ç ï¼Œæ³¨æ„å¤šè¡¥å……ä¸€äº›æ ¡éªŒæ¡ä»¶ï¼š

```java
@Override
public long userRegister(String userAccount, String userPassword, String checkPassword) {
    // 1. æ ¡éªŒ
    if (StrUtil.hasBlank(userAccount, userPassword, checkPassword)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "å‚æ•°ä¸ºç©º");
    }
    if (userAccount.length() < 4) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·è´¦å·è¿‡çŸ­");
    }
    if (userPassword.length() < 8 || checkPassword.length() < 8) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·å¯†ç è¿‡çŸ­");
    }
    if (!userPassword.equals(checkPassword)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´");
    }
    // 2. æ£€æŸ¥æ˜¯å¦é‡å¤
    QueryWrapper queryWrapper = new QueryWrapper();
    queryWrapper.eq("userAccount", userAccount);
    long count = this.mapper.selectCountByQuery(queryWrapper);
    if (count > 0) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "è´¦å·é‡å¤");
    }
    // 3. åŠ å¯†
    String encryptPassword = getEncryptPassword(userPassword);
    // 4. æ’å…¥æ•°æ®
    User user = new User();
    user.setUserAccount(userAccount);
    user.setUserPassword(encryptPassword);
    user.setUserName("æ— å");
    user.setUserRole(UserRoleEnum.USER.getValue());
    boolean saveResult = this.save(user);
    if (!saveResult) {
        throw new BusinessException(ErrorCode.SYSTEM_ERROR, "æ³¨å†Œå¤±è´¥ï¼Œæ•°æ®åº“é”™è¯¯");
    }
    return user.getId();
}
```

æ³¨æ„ï¼Œä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†â ç”¨æˆ·å¯†ç åŠ å¯†åè¿›è¡Œâ å­˜å‚¨ã€‚å¯ä»¥å°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œä¾¿äºåç»­å¤ç”¨ï¼š1vM0bC71h2RCfUkazMGszlP9tIpAZTvdkFrdc8O6/+w=

```java
@Override
public String getEncryptPassword(String userPassword) {
    // ç›å€¼ï¼Œæ··æ·†å¯†ç 
    final String SALT = "yupi";
    return DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());
}
```

#### 3ã€æ¥å£å¼€å‘

åœ¨ `controller` åŒ…ä¸­æ–°å»º UserControllerï¼Œæ–°å¢ç”¨æˆ·æ³¨å†Œæ¥å£ï¼šqo3wYiJtEuojZDmpW2HRDEwGWUH1DzVFQ47Zs4YmYuk=

```java
@RestController
@RequestMapping("/user")
public class UserController {

    @Resource
    private UserService userService;

    /**
     * ç”¨æˆ·æ³¨å†Œ
     *
     * @param userRegisterRequest ç”¨æˆ·æ³¨å†Œè¯·æ±‚
     * @return æ³¨å†Œç»“æœ
     */
    @PostMapping("register")
    public BaseResponse<Long> userRegister(@RequestBody UserRegisterRequest userRegisterRequest) {
        ThrowUtils.throwIf(userRegisterRequest == null, ErrorCode.PARAMS_ERROR);
        String userAccount = userRegisterRequest.getUserAccount();
        String userPassword = userRegisterRequest.getUserPassword();
        String checkPassword = userRegisterRequest.getCheckPassword();
        long result = userService.userRegister(userAccount, userPassword, checkPassword);
        return ResultUtils.success(result);
    }
}
```

#### 4ã€æµ‹è¯•

æ¯å¼€å‘å®Œä¸€ä¸ªæ¥å£ï¼Œéƒ½å¯ä»¥ä½¿ç”¨â  Swagger â æ¥å£æ–‡æ¡£æ¥æµ‹è¯•ï¼šUzapLzatIvJJsWWs1pRz7879eXluI/+jA6d4qBCHuKE=

![](https://pic.code-nav.cn/course_picture/1608440217629360130/l4GNqiOUy72sgA9n.webp)

ğŸ’¡ æµ‹è¯•æ—¶è¦å°¤å…¶æ³¨æ„è¾¹ç•Œå€¼â å’Œç‰¹æ®Šå€¼ï¼Œä¸èƒ½åªæµ‹â è¯•æ­£å¸¸çš„æƒ…å†µã€‚

### ç”¨æˆ·ç™»å½•

#### 1ã€æ•°æ®æ¨¡å‹

åœ¨ `model.dto.user` ä¸‹æ–°å»ºç”¨äºæ¥å—è¯·æ±‚å‚æ•°çš„ç±»ï¼š

```java
@Data
public class UserLoginRequest implements Serializable {

    private static final long serialVersionUID = 3191241716373120793L;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * å¯†ç 
     */
    private String userPassword;
}
```

#### 2ã€æ•°æ®è„±æ•

æ— è®ºæ˜¯ç”¨æˆ·æ³¨å†Œè¿˜æ˜¯ç”¨æˆ·ç™»å½•æ¥å£ï¼Œéƒ½åº”è¯¥è¿”å›â å·²ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œä¸”ä¸€å®šè¦â å¯¹è¿”å›ç»“æœè¿›è¡Œè„±æ•å¤„ç†ï¼Œä¸èƒ½ç›´æ¥å°†æ•°æ®åº“æŸ¥åˆ°çš„æ‰€æœ‰ä¿¡æ¯éƒ½è¿”å›ç»™äº†å‰ç«¯ï¼ˆåŒ…æ‹¬å¯†ç ï¼‰ã€‚

åœ¨ `model.vo` åŒ…ä¸‹æ–°å»º `LoginUserVO` ç±»ï¼Œè¡¨ç¤ºè„±æ•åçš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼šdWCTYpHEFA/xV8BrvOpKRqkO1d88b9Ip8VkvBeLuZho=

```java
@Data
public class LoginUserVO implements Serializable {

    /**
     * ç”¨æˆ· id
     */
    private Long id;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private LocalDateTime createTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    private LocalDateTime updateTime;

    private static final long serialVersionUID = 1L;
}
```

åœ¨ UserService â ä¸­æ–°å¢è·å–è„±æ•åçš„â å·²ç™»å½•ç”¨æˆ·ä¿¡æ¯æ–¹æ³•ï¼š

```java
/**
 * è·å–è„±æ•çš„å·²ç™»å½•ç”¨æˆ·ä¿¡æ¯
 *
 * @return
 */
LoginUserVO getLoginUserVO(User user);
```

ç¼–å†™æ–¹æ³•å¯¹åº”çš„å®ç°ç±»ï¼Œå…¶å®å°±æ˜¯â å°† User ç±»çš„å±â æ€§å¤åˆ¶åˆ° LoginUserVO ä¸­ï¼Œä¸å­˜åœ¨çš„å­—æ®µå°±è¢«è¿‡æ»¤æ‰äº†ï¼š

```java
@Override
public LoginUserVO getLoginUserVO(User user) {
    if (user == null) {
        return null;
    }
    LoginUserVO loginUserVO = new LoginUserVO();
    BeanUtil.copyProperties(user, loginUserVO);
    return loginUserVO;
}
```

#### 3ã€æœåŠ¡å¼€å‘

åœ¨ `service` åŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼š

```java
/**
 * ç”¨æˆ·ç™»å½•
 *
 * @param userAccount  ç”¨æˆ·è´¦æˆ·
 * @param userPassword ç”¨æˆ·å¯†ç 
 * @param request
 * @return è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯
 */
LoginUserVO userLogin(String userAccount, String userPassword, HttpServletRequest request);
```

åœ¨ UserServiceImpl ä¸­å¢â åŠ å®ç°ä»£ç ï¼Œæ³¨æ„å¤šè¡¥å……ä¸€äº›â æ ¡éªŒæ¡ä»¶ï¼Œåœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨å½“å‰çš„ Session ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š1vM0bC71h2RCfUkazMGszlP9tIpAZTvdkFrdc8O6/+w=

```java
@Override
public LoginUserVO userLogin(String userAccount, String userPassword, HttpServletRequest request) {
    // 1. æ ¡éªŒ
    if (StrUtil.hasBlank(userAccount, userPassword)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "å‚æ•°ä¸ºç©º");
    }
    if (userAccount.length() < 4) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "è´¦å·é”™è¯¯");
    }
    if (userPassword.length() < 8) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "å¯†ç é”™è¯¯");
    }
    // 2. åŠ å¯†
    String encryptPassword = getEncryptPassword(userPassword);
    // æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    QueryWrapper queryWrapper = new QueryWrapper();
    queryWrapper.eq("userAccount", userAccount);
    queryWrapper.eq("userPassword", encryptPassword);
    User user = this.mapper.selectOneByQuery(queryWrapper);
    // ç”¨æˆ·ä¸å­˜åœ¨
    if (user == null) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·ä¸å­˜åœ¨æˆ–å¯†ç é”™è¯¯");
    }
    // 3. è®°å½•ç”¨æˆ·çš„ç™»å½•æ€
    request.getSession().setAttribute(USER_LOGIN_STATE, user);
    // 4. è·å¾—è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯
    return this.getLoginUserVO(user);
}
```

æ³¨æ„ï¼Œç”±äºæ³¨å†Œç”¨æˆ·æ—¶å­˜å…¥æ•°æ®åº“çš„å¯†ç â æ˜¯åŠ å¯†åçš„ï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯â æ—¶ï¼Œä¹Ÿè¦å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒåŒæ ·ç®—æ³•çš„åŠ å¯†ï¼Œæ‰èƒ½è·Ÿæ•°æ®åº“çš„ä¿¡æ¯å¯¹åº”ä¸Šã€‚

å¯ä»¥æŠŠä¸Šè¿°çš„ Session ç†è§£ä¸ºä¸€ä¸ª Mapï¼Œå¯ä»¥ç»™ Map è®¾ç½® key å’Œ valueï¼Œæ¯ä¸ªä¸åŒçš„ SessionID å¯¹åº”çš„ Session å­˜å‚¨éƒ½æ˜¯ä¸åŒçš„ï¼Œä¸ç”¨æ‹…å¿ƒä¼šæ±¡æŸ“ã€‚æ‰€ä»¥ä¸Šè¿°ä»£ç ä¸­ï¼Œç»™ Session è®¾ç½®äº†å›ºå®šçš„ keyï¼ˆUSER\_LOGIN\_STATEï¼‰ï¼Œå¯ä»¥å°†è¿™ä¸ª key å€¼æå–ä¸ºå¸¸é‡ï¼Œä¾¿äºåç»­è·å–ã€‚WBpr9WI72APgOj+DCCZKObs+ofP0VhBHSvqSELGriv0=

åœ¨ `constant` åŒ…ä¸‹æ–°å»º UserConstant ç±»ï¼Œç»Ÿä¸€å£°æ˜ç”¨æˆ·ç›¸å…³çš„å¸¸é‡ï¼š

```java
public interface UserConstant {

    /**
     * ç”¨æˆ·ç™»å½•æ€é”®
     */
    String USER_LOGIN_STATE = "user_login";

    //  region æƒé™

    /**
     * é»˜è®¤è§’è‰²
     */
    String DEFAULT_ROLE = "user";

    /**
     * ç®¡ç†å‘˜è§’è‰²
     */
    String ADMIN_ROLE = "admin";
    
    // endregion
}
```

#### 4ã€æ¥å£å¼€å‘

åœ¨ UserController ä¸­æ–°å¢ç”¨æˆ·ç™»å½•æ¥å£ï¼š

```java
@PostMapping("/login")
public BaseResponse<LoginUserVO> userLogin(@RequestBody UserLoginRequest userLoginRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(userLoginRequest == null, ErrorCode.PARAMS_ERROR);
    String userAccount = userLoginRequest.getUserAccount();
    String userPassword = userLoginRequest.getUserPassword();
    LoginUserVO loginUserVO = userService.userLogin(userAccount, userPassword, request);
    return ResultUtils.success(loginUserVO);
}
```

### è·å–å½“å‰ç™»å½•ç”¨æˆ·

å¯ä»¥ä» request è¯·æ±‚å¯¹â è±¡å¯¹åº”çš„ Sessiâ on ä¸­ç›´æ¥è·å–åˆ°ä¹‹å‰ä¿å­˜çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€å…¶ä»–è¯·æ±‚å‚æ•°ã€‚

#### 1ã€æœåŠ¡å¼€å‘

åœ¨ `service` åŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼šcZq9/nGwbRXl38gxWuOGAJfnulyo9Sx2vt9GhAJuMwQ=

```java
/**
 * è·å–å½“å‰ç™»å½•ç”¨æˆ·
 *
 * @param request
 * @return
 */
User getLoginUser(HttpServletRequest request);
```

åœ¨ UserServiceImpl ä¸­å¢åŠ å®ç°ä»£â ç ï¼Œæ­¤å¤„ä¸ºäº†ä¿è¯è·å–åˆ°çš„æ•°æ®å§‹ç»ˆâ æ˜¯æœ€æ–°çš„ï¼Œå…ˆä» Session ä¸­è·å–ç™»å½•ç”¨æˆ·çš„ idï¼Œç„¶åä»æ•°æ®åº“ä¸­æŸ¥è¯¢æœ€æ–°çš„ç»“æœã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
@Override
public User getLoginUser(HttpServletRequest request) {
    // å…ˆåˆ¤æ–­æ˜¯å¦å·²ç™»å½•
    Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);
    User currentUser = (User) userObj;
    if (currentUser == null || currentUser.getId() == null) {
        throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);
    }
    // ä»æ•°æ®åº“æŸ¥è¯¢ï¼ˆè¿½æ±‚æ€§èƒ½çš„è¯å¯ä»¥æ³¨é‡Šï¼Œç›´æ¥è¿”å›ä¸Šè¿°ç»“æœï¼‰
    long userId = currentUser.getId();
    currentUser = this.getById(userId);
    if (currentUser == null) {
        throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);
    }
    return currentUser;
}
```

#### 2ã€æ¥å£å¼€å‘

åœ¨ UserController ä¸­æ–°å¢è·å–å½“å‰ç™»å½•ç”¨æˆ·æ¥å£ï¼Œæ³¨æ„ä¸€å®šè¦ **è¿”å›è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯ï¼**

```java
@GetMapping("/get/login")
public BaseResponse<LoginUserVO> getLoginUser(HttpServletRequest request) {
    User loginUser = userService.getLoginUser(request);
    return ResultUtils.success(userService.getLoginUserVO(loginUser));
}
```

### ç”¨æˆ·æ³¨é”€

å¯ä»¥ä» request è¯·æ±‚å¯¹è±¡å¯¹â åº”çš„ Session â ä¸­ç›´æ¥è·å–åˆ°ä¹‹å‰ä¿å­˜çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œæ¥å®Œæˆæ³¨é”€ï¼Œæ— éœ€å…¶ä»–è¯·æ±‚å‚æ•°ã€‚

#### 1ã€æœåŠ¡å¼€å‘

åœ¨ `service` åŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼š

```java
/**
 * ç”¨æˆ·æ³¨é”€
 *
 * @param request
 * @return
 */
boolean userLogout(HttpServletRequest request);
```

åœ¨ UserServiceIâ mpl ä¸­å¢åŠ å®ç°â ä»£ç ï¼Œä» Session ä¸­ç§»é™¤æ‰å½“å‰ç”¨æˆ·çš„ç™»å½•æ€å³å¯ï¼šcZq9/nGwbRXl38gxWuOGAJfnulyo9Sx2vt9GhAJuMwQ=

```java
@Override
public boolean userLogout(HttpServletRequest request) {
    // å…ˆåˆ¤æ–­æ˜¯å¦å·²ç™»å½•
    Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);
    if (userObj == null) {
        throw new BusinessException(ErrorCode.OPERATION_ERROR, "æœªç™»å½•");
    }
    // ç§»é™¤ç™»å½•æ€
    request.getSession().removeAttribute(USER_LOGIN_STATE);
    return true;
}
```

#### 2ã€æ¥å£å¼€å‘

åœ¨ UserController ä¸­æ–°å¢ç”¨æˆ·æ³¨é”€æ¥å£ï¼šqo3wYiJtEuojZDmpW2HRDEwGWUH1DzVFQ47Zs4YmYuk=

```java
@PostMapping("/logout")
public BaseResponse<Boolean> userLogout(HttpServletRequest request) {
    ThrowUtils.throwIf(request == null, ErrorCode.PARAMS_ERROR);
    boolean result = userService.userLogout(request);
    return ResultUtils.success(result);
}
```

### ç”¨æˆ·æƒé™æ§åˆ¶

æƒé™æ ¡éªŒå…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸€èˆ¬ä¼šé€šè¿‡ **Spring AOP åˆ‡é¢ + è‡ªå®šä¹‰æƒé™æ ¡éªŒæ³¨è§£** å®ç°ç»Ÿä¸€çš„æ¥å£æ‹¦æˆªå’Œæƒé™æ ¡éªŒã€‚å¦‚æœæœ‰ç‰¹æ®Šçš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå†å•ç‹¬åœ¨æ¥å£ä¸­ç¼–ç ã€‚UzapLzatIvJJsWWs1pRz7879eXluI/+jA6d4qBCHuKE=

#### 1ã€æƒé™æ ¡éªŒæ³¨è§£

é¦–å…ˆç¼–å†™æƒé™æ ¡éªŒæ³¨è§£ï¼Œæ”¾åˆ° `annotation` åŒ…ä¸‹ï¼š

```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface AuthCheck {

    /**
     * å¿…é¡»æœ‰æŸä¸ªè§’è‰²
     */
    String mustRole() default "";
}
```

#### 2ã€æƒé™æ ¡éªŒåˆ‡é¢

ç¼–å†™æƒé™æ ¡éªŒ AOPï¼Œé‡‡ç”¨ç¯ç»•é€šçŸ¥ï¼Œåœ¨ **æ‰“ä¸Šè¯¥æ³¨è§£çš„æ–¹æ³•** æ‰§è¡Œå‰åè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œæ¯”å¦‚æ ¡éªŒæƒé™ã€‚

ä»£ç å¦‚ä¸‹ï¼Œæ”¾åˆ° `aop` åŒ…ä¸‹ï¼š1vM0bC71h2RCfUkazMGszlP9tIpAZTvdkFrdc8O6/+w=

```java
@Aspect
@Component
public class AuthInterceptor {

    @Resource
    private UserService userService;

    /**
     * æ‰§è¡Œæ‹¦æˆª
     *
     * @param joinPoint åˆ‡å…¥ç‚¹
     * @param authCheck æƒé™æ ¡éªŒæ³¨è§£
     */
    @Around("@annotation(authCheck)")
    public Object doInterceptor(ProceedingJoinPoint joinPoint, AuthCheck authCheck) throws Throwable {
        String mustRole = authCheck.mustRole();
        RequestAttributes requestAttributes = RequestContextHolder.currentRequestAttributes();
        HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();
        // å½“å‰ç™»å½•ç”¨æˆ·
        User loginUser = userService.getLoginUser(request);
        UserRoleEnum mustRoleEnum = UserRoleEnum.getEnumByValue(mustRole);
        // ä¸éœ€è¦æƒé™ï¼Œæ”¾è¡Œ
        if (mustRoleEnum == null) {
            return joinPoint.proceed();
        }
        // ä»¥ä¸‹ä¸ºï¼šå¿…é¡»æœ‰è¯¥æƒé™æ‰é€šè¿‡
        // è·å–å½“å‰ç”¨æˆ·å…·æœ‰çš„æƒé™
        UserRoleEnum userRoleEnum = UserRoleEnum.getEnumByValue(loginUser.getUserRole());
        // æ²¡æœ‰æƒé™ï¼Œæ‹’ç»
        if (userRoleEnum == null) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        // è¦æ±‚å¿…é¡»æœ‰ç®¡ç†å‘˜æƒé™ï¼Œä½†ç”¨æˆ·æ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼Œæ‹’ç»
        if (UserRoleEnum.ADMIN.equals(mustRoleEnum) && !UserRoleEnum.ADMIN.equals(userRoleEnum)) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        // é€šè¿‡æƒé™æ ¡éªŒï¼Œæ”¾è¡Œ
        return joinPoint.proceed();
    }
}
```

#### 3ã€ä½¿ç”¨æ³¨è§£

åªè¦ç»™æ–¹æ³•æ·»åŠ äº† `@AuthCheck` æ³¨è§£ï¼Œå°±å¿…é¡»è¦ç™»å½•ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚UzapLzatIvJJsWWs1pRz7879eXluI/+jA6d4qBCHuKE=

å¯ä»¥è®¾ç½® mustRole â ä¸ºç®¡ç†å‘˜ï¼Œè¿™æ ·ä»…ç®¡â ç†å‘˜æ‰èƒ½ä½¿ç”¨è¯¥æ¥å£ï¼š

```java
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
```

å¯¹äºä¸éœ€è¦ç™»å½•å°±èƒ½ä½¿ç”¨çš„æ¥å£ï¼Œä¸éœ€è¦ä½¿ç”¨è¯¥æ³¨è§£ã€‚qo3wYiJtEuojZDmpW2HRDEwGWUH1DzVFQ47Zs4YmYuk=

ğŸ’¡ å¦‚æœè¦å­¦ä¹ æ›´å¤æ‚çš„ä¼ä¸šçº§æƒé™æ§åˆ¶æ–¹æ¡ˆå’Œ Sa-Token æƒé™æ ¡éªŒæ¡†æ¶ï¼Œå¯ä»¥çœ‹ [ç¼–ç¨‹å¯¼èˆªçš„æ™ºèƒ½ååŒäº‘å›¾åº“é¡¹ç›®](https://www.codefather.cn/course/1864210260732116994)ã€‚

### ç”¨æˆ·ç®¡ç†

ç”¨æˆ·ç®¡ç†éœ€æ±‚å…·ä½“å¯ä»¥æ‹†åˆ†ä¸ºï¼šp+CfRPZxNEuU7hG8dzfPcN4R10eC9eypGHmTaRf/x7c=

-   ã€ç®¡ç†å‘˜ã€‘åˆ›å»ºç”¨æˆ·
-   ã€ç®¡ç†å‘˜ã€‘æ ¹æ® id åˆ é™¤ç”¨æˆ·
-   ã€ç®¡ç†å‘˜ã€‘æ›´æ–°ç”¨æˆ·
-   ã€ç®¡ç†å‘˜ã€‘åˆ†é¡µè·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆéœ€è¦è„±æ•ï¼‰
-   ã€ç®¡ç†å‘˜ã€‘æ ¹æ® id è·å–ç”¨æˆ·ï¼ˆæœªè„±æ•ï¼‰
-   æ ¹æ® id è·å–ç”¨æˆ·ï¼ˆè„±æ•ï¼‰

#### 1ã€æ•°æ®æ¨¡å‹

1ï¼‰æ¯ä¸ªæ“ä½œéƒ½éœ€è¦æä¾›ä¸€ä¸ªè¯·æ±‚ç±»ï¼Œéƒ½æ”¾åœ¨ `dto.user` åŒ…ä¸‹ã€‚cZq9/nGwbRXl38gxWuOGAJfnulyo9Sx2vt9GhAJuMwQ=

![](https://pic.code-nav.cn/course_picture/1608440217629360130/NtDPf7fRX6Rb6u8I.webp)

ç”¨æˆ·åˆ›å»ºè¯·æ±‚ï¼š

```java
@Data
public class UserAddRequest implements Serializable {

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²: user, admin
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}
```

ç”¨æˆ·æ›´æ–°è¯·æ±‚ï¼š

```java
@Data
public class UserUpdateRequest implements Serializable {

    /**
     * id
     */
    private Long id;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}
```

ç”¨æˆ·æŸ¥è¯¢è¯·æ±‚ï¼Œéœ€è¦ç»§æ‰¿å…¬å…±åŒ…ä¸­çš„ `PageRequest` æ¥æ”¯æŒåˆ†é¡µæŸ¥è¯¢ï¼šcZq9/nGwbRXl38gxWuOGAJfnulyo9Sx2vt9GhAJuMwQ=

```java
@EqualsAndHashCode(callSuper = true)
@Data
public class UserQueryRequest extends PageRequest implements Serializable {

    /**
     * id
     */
    private Long id;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin/ban
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}
```

2ï¼‰ç”±äºè¦æä¾›è·å–ç”¨æˆ·ä¿¡æ¯çš„â æ¥å£ï¼Œéœ€è¦å’Œè·å–å½“â å‰ç™»å½•ç”¨æˆ·æ¥å£ä¸€æ ·å¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œè„±æ•ã€‚

åœ¨ `model.vo` åŒ…ä¸‹æ–°å»º UserVOï¼Œè¡¨ç¤ºè„±æ•åçš„ç”¨æˆ·ï¼šWBpr9WI72APgOj+DCCZKObs+ofP0VhBHSvqSELGriv0=

```java
@Data
public class UserVO implements Serializable {

    /**
     * id
     */
    private Long id;
    
    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private LocalDateTime createTime;

    private static final long serialVersionUID = 1L;
}
```

#### 2ã€æœåŠ¡å¼€å‘

1ï¼‰åœ¨ UserServicâ e ä¸­ç¼–å†™è·å–è„±æ•â åçš„å•ä¸ªç”¨æˆ·ä¿¡æ¯ã€è·å–è„±æ•åçš„ç”¨æˆ·åˆ—è¡¨æ–¹æ³•ï¼šnShO7+0zZStNyiJdnnoFDwT4JyyptzNsRjyXLsolAAU=

```java
@Override
public UserVO getUserVO(User user) {
    if (user == null) {
        return null;
    }
    UserVO userVO = new UserVO();
    BeanUtil.copyProperties(user, userVO);
    return userVO;
}

@Override
public List<UserVO> getUserVOList(List<User> userList) {
    if (CollUtil.isEmpty(userList)) {
        return new ArrayList<>();
    }
    return userList.stream().map(this::getUserVO).collect(Collectors.toList());
}
```

2ï¼‰é™¤äº†ä¸Šè¿°æ–¹æ³•å¤–ï¼Œå¯¹äºåˆ†é¡µæŸ¥è¯¢æ¥å£ï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å‚æ•°â æ¥æ„é€  SQL æŸ¥è¯¢ã€‚ç”±äºä½¿ç”¨ MyBaâ tis Flex æ¡†æ¶ï¼Œä¸ç”¨è‡ªå·±æ‹¼æ¥ SQL äº†ï¼Œè€Œæ˜¯é€šè¿‡æ„é€  QueryWrapper å¯¹è±¡æ¥ç”Ÿæˆ SQL æŸ¥è¯¢ã€‚

å¯ä»¥åœ¨ UserServicâ e ä¸­ç¼–å†™ä¸€ä¸ªæ–¹æ³•â ï¼Œä¸“é—¨ç”¨äºå°†æŸ¥è¯¢è¯·æ±‚è½¬ä¸º QueryWrapper å¯¹è±¡ï¼šcZq9/nGwbRXl38gxWuOGAJfnulyo9Sx2vt9GhAJuMwQ=

```java
@Override
public QueryWrapper getQueryWrapper(UserQueryRequest userQueryRequest) {
    if (userQueryRequest == null) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "è¯·æ±‚å‚æ•°ä¸ºç©º");
    }
    Long id = userQueryRequest.getId();
    String userAccount = userQueryRequest.getUserAccount();
    String userName = userQueryRequest.getUserName();
    String userProfile = userQueryRequest.getUserProfile();
    String userRole = userQueryRequest.getUserRole();
    String sortField = userQueryRequest.getSortField();
    String sortOrder = userQueryRequest.getSortOrder();
    return QueryWrapper.create()
            .eq("id", id)
            .eq("userRole", userRole)
            .like("userAccount", userAccount)
            .like("userName", userName)
            .like("userProfile", userProfile)
            .orderBy(sortField, "ascend".equals(sortOrder));
}
```

æ›´å¤š QueryWrapper çš„è¯¦ç»†ç”¨æ³•å¯ä»¥æŸ¥çœ‹ [MyBatis Flex çš„å®˜æ–¹æ–‡æ¡£](https://mybatis-flex.com/zh/base/querywrapper.html)ï¼Œæ”¯æŒå…³è”æŸ¥è¯¢ï¼Œå¾ˆæ–¹ä¾¿ã€‚

#### 3ã€æ¥å£å¼€å‘

ä¸Šè¿°åŠŸèƒ½å…¶å®éƒ½æ˜¯æ ·æ¿ä»£ç ï¼Œä¿—ç§° â€œå¢åˆ æ”¹æŸ¥â€ã€‚

ä»£ç å®ç°æ¯”è¾ƒç®€å•ï¼Œæ³¨æ„æ·»åŠ å¯¹â åº”çš„æƒé™æ³¨è§£ã€åšå¥½â å‚æ•°æ ¡éªŒå³å¯ï¼š

```java
/**
 * åˆ›å»ºç”¨æˆ·
 */
@PostMapping("/add")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Long> addUser(@RequestBody UserAddRequest userAddRequest) {
    ThrowUtils.throwIf(userAddRequest == null, ErrorCode.PARAMS_ERROR);
    User user = new User();
    BeanUtil.copyProperties(userAddRequest, user);
    // é»˜è®¤å¯†ç  12345678
    final String DEFAULT_PASSWORD = "12345678";
    String encryptPassword = userService.getEncryptPassword(DEFAULT_PASSWORD);
    user.setUserPassword(encryptPassword);
    boolean result = userService.save(user);
    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
    return ResultUtils.success(user.getId());
}

/**
 * æ ¹æ® id è·å–ç”¨æˆ·ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
 */
@GetMapping("/get")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<User> getUserById(long id) {
    ThrowUtils.throwIf(id <= 0, ErrorCode.PARAMS_ERROR);
    User user = userService.getById(id);
    ThrowUtils.throwIf(user == null, ErrorCode.NOT_FOUND_ERROR);
    return ResultUtils.success(user);
}

/**
 * æ ¹æ® id è·å–åŒ…è£…ç±»
 */
@GetMapping("/get/vo")
public BaseResponse<UserVO> getUserVOById(long id) {
    BaseResponse<User> response = getUserById(id);
    User user = response.getData();
    return ResultUtils.success(userService.getUserVO(user));
}

/**
 * åˆ é™¤ç”¨æˆ·
 */
@PostMapping("/delete")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Boolean> deleteUser(@RequestBody DeleteRequest deleteRequest) {
    if (deleteRequest == null || deleteRequest.getId() <= 0) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    boolean b = userService.removeById(deleteRequest.getId());
    return ResultUtils.success(b);
}

/**
 * æ›´æ–°ç”¨æˆ·
 */
@PostMapping("/update")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Boolean> updateUser(@RequestBody UserUpdateRequest userUpdateRequest) {
    if (userUpdateRequest == null || userUpdateRequest.getId() == null) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    User user = new User();
    BeanUtil.copyProperties(userUpdateRequest, user);
    boolean result = userService.updateById(user);
    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
    return ResultUtils.success(true);
}

/**
 * åˆ†é¡µè·å–ç”¨æˆ·å°è£…åˆ—è¡¨ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
 *
 * @param userQueryRequest æŸ¥è¯¢è¯·æ±‚å‚æ•°
 */
@PostMapping("/list/page/vo")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Page<UserVO>> listUserVOByPage(@RequestBody UserQueryRequest userQueryRequest) {
    ThrowUtils.throwIf(userQueryRequest == null, ErrorCode.PARAMS_ERROR);
    long pageNum = userQueryRequest.getPageNum();
    long pageSize = userQueryRequest.getPageSize();
    Page<User> userPage = userService.page(Page.of(pageNum, pageSize),
            userService.getQueryWrapper(userQueryRequest));
    // æ•°æ®è„±æ•
    Page<UserVO> userVOPage = new Page<>(pageNum, pageSize, userPage.getTotalRow());
    List<UserVO> userVOList = userService.getUserVOList(userPage.getRecords());
    userVOPage.setRecords(userVOList);
    return ResultUtils.success(userVOPage);
}
```

ğŸ’¡ æœ‰åŒå­¦å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼šä¸â æ˜¯è¯´ä¸è¦åœ¨ Conâ troller ä¸­å†™ä¸šåŠ¡é€»è¾‘ä»£ç ä¹ˆï¼Ÿ

æˆ‘çš„å»ºè®®æ˜¯ **å¼€å‘æ—¶è¦çµæ´»ä¸€äº›**ï¼Œæˆ‘ä»¬è¦ä¿è¯ Controller çš„ç²¾ç®€æ²¡é”™ï¼Œä½†ä¸ä»£è¡¨ä»€ä¹ˆä»£ç éƒ½ä¸åœ¨ Controller é‡Œå†™ã€‚å¯¹äºæˆ‘ä»¬ä¸Šè¿°çš„ä»£ç ï¼Œæ ¹æœ¬å°±æ²¡æœ‰å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸”ä¹Ÿå·²ç»è°ƒç”¨ Service æ¥å®ç°äº†ã€‚å¦‚æœéè¦æŠ½ä¸€å±‚ Service æ–¹æ³•ä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œä½†ä¼šæ›´éº»çƒ¦ä¸€äº›ã€‚

### åŠŸèƒ½æµ‹è¯•

æœ€åï¼Œä½¿ç”¨ Swagger æ¥å£æ–‡æ¡£ä¾æ¬¡â å¯¹ä¸Šè¿°æ¥å£è¿›è¡Œæµ‹è¯•ï¼Œå°¤å…¶æ˜¯â æµ‹è¯•ç”¨æˆ·æƒé™å’Œåˆ†é¡µæ¥å£ã€‚å¯ä»¥å…ˆæ³¨å†Œç”¨æˆ·ï¼Œç„¶ååˆ°æ•°æ®åº“ä¸­ä¿®æ”¹æƒé™ä¸ºç®¡ç†å‘˜ï¼Œä¾¿äºæµ‹è¯•ã€‚

![](https://pic.code-nav.cn/course_picture/1608440217629360130/bs4pFDlZX9QWVU9W.webp)

#### æ•°æ®ç²¾åº¦ä¿®å¤

åœ¨æµ‹è¯•ä¸­ï¼Œå¦‚æœä½ æ‰“å¼€ F12 å¼€å‘â è€…å·¥å…·ï¼Œåˆ©ç”¨é¢„è§ˆæ¥æŸ¥çœ‹â å“åº”æ•°æ®ï¼Œå°±ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼šid çš„æœ€åä¸¤ä½å¥½åƒéƒ½å˜æˆ 0 äº†ï¼

![](https://pic.code-nav.cn/course_picture/1608440217629360130/8uv82osCtKukYWyG.webp)

ä½†æ˜¯åœ¨å“åº”ä¸­ã€ä»¥åŠ Swagger ä¸­æŸ¥çœ‹ï¼Œå´æ˜¯æ­£å¸¸çš„ï¼š1vM0bC71h2RCfUkazMGszlP9tIpAZTvdkFrdc8O6/+w=

![](https://pic.code-nav.cn/course_picture/1608440217629360130/yMfrsr2H96x7OneA.webp)

è¿™æ˜¯ç”±äºå‰ç«¯ JS çš„ç²¾åº¦èŒƒå›´æœ‰é™ï¼Œæˆ‘ä»¬â åç«¯è¿”å›çš„ id èŒƒå›´è¿‡å¤§â ï¼Œå¯¼è‡´å‰ç«¯è§£æ JSON æ—¶å‡ºç°ç²¾åº¦ä¸¢å¤±ï¼Œä¼šå½±å“å‰ç«¯é¡µé¢è·å–åˆ°çš„æ•°æ®ç»“æœã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨åç«¯ `config` åŒ…ä¸‹æ–°å»ºä¸€ä¸ªå…¨å±€ JSON é…ç½®ï¼Œå°†æ•´ä¸ªåç«¯ Spring MVC æ¥å£è¿”å›å€¼çš„é•¿æ•´å‹æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œè¿”å›ï¼Œä»è€Œé›†ä¸­è§£å†³é—®é¢˜ã€‚qo3wYiJtEuojZDmpW2HRDEwGWUH1DzVFQ47Zs4YmYuk=

```java
/**
 * Spring MVC Json é…ç½®
 */
@JsonComponent
public class JsonConfig {

    /**
     * æ·»åŠ  Long è½¬ json ç²¾åº¦ä¸¢å¤±çš„é…ç½®
     */
    @Bean
    public ObjectMapper jacksonObjectMapper(Jackson2ObjectMapperBuilder builder) {
        ObjectMapper objectMapper = builder.createXmlMapper(false).build();
        SimpleModule module = new SimpleModule();
        module.addSerializer(Long.class, ToStringSerializer.instance);
        module.addSerializer(Long.TYPE, ToStringSerializer.instance);
        objectMapper.registerModule(module);
        return objectMapper;
    }
}
```

é‡å¯é¡¹ç›®è¿›è¡Œæµ‹è¯•ï¼Œè¿™æ¬¡çœ‹åˆ°çš„ id å€¼å°±æ­£å¸¸äº†ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/PjILBtuURCtwJNZ3.webp)dWCTYpHEFA/xV8BrvOpKRqkO1d88b9Ip8VkvBeLuZho=

è‡³æ­¤ï¼Œç”¨æˆ·ç›¸å…³çš„åç«¯æ¥å£å¼€å‘â å®Œæ¯•ï¼Œå¤§å®¶å¯ä»¥æŒ‰éœ€â å®Œå–„ä¸Šè¿°ä»£ç ã€‚

## å‰ç«¯å¼€å‘

### æ–°å»ºé¡µé¢å’Œè·¯ç”±

æŒ‰ç…§ä¸‹å›¾çš„ç»“æ„æ–°å»ºé¡µé¢æ–‡ä»¶ï¼Œâ å°†æ‰€æœ‰é¡µé¢æŒ‰ç…§ uâ rl å±‚çº§è¿›è¡Œåˆ›å»ºï¼Œå¹¶ä¸”é¡µé¢åç§°å°½é‡åšåˆ° â€œè§åçŸ¥æ„â€ã€‚

![](https://pic.code-nav.cn/course_picture/1608440217629360130/xi50gyq1wD1C8ZL5.webp)

å…¶ä¸­ï¼Œ`/user/login` åœ°å€å°±å¯¹åº”äº† UserLoginPageï¼Œä»¥æ­¤ç±»æ¨ã€‚cZq9/nGwbRXl38gxWuOGAJfnulyo9Sx2vt9GhAJuMwQ=

ä¿®æ”¹ `router/index.ts` çš„è·¯ç”±é…ç½®ï¼š

```typescript
routes: [
  {
    path: '/',
    name: 'ä¸»é¡µ',
    component: HomePage,
  },
  {
    path: '/user/login',
    name: 'ç”¨æˆ·ç™»å½•',
    component: UserLoginPage,
  },
  {
    path: '/user/register',
    name: 'ç”¨æˆ·æ³¨å†Œ',
    component: UserRegisterPage,
  },
  {
    path: '/admin/userManage',
    name: 'ç”¨æˆ·ç®¡ç†',
    component: UserManagePage,
  },
],
```

è®°å¾—æ‰§è¡Œä¸€ä¸‹ openapiâ  å·¥å…·ç”Ÿæˆæ¥å£å¯¹åº”â çš„è¯·æ±‚ä»£ç ï¼Œæ¯æ¬¡åç«¯æ”¹åŠ¨æ—¶éƒ½éœ€è¦è¿™ä¹ˆåšã€‚1vM0bC71h2RCfUkazMGszlP9tIpAZTvdkFrdc8O6/+w=

### è·å–å½“å‰ç™»å½•ç”¨æˆ· - å…¨å±€çŠ¶æ€ç®¡ç†

ç”±äºä¹‹åå¾ˆå¤šé¡µé¢éƒ½éœ€è¦è·å–åˆ°å½“â å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œéœ€è¦â æŠŠè¿™ä¸ªæ•°æ®ä½œä¸ºå…¨å±€çŠ¶æ€æ¥ç®¡ç†ï¼Œè€Œä¸æ˜¯æ¯ä¸ªé¡µé¢åˆ†åˆ«ç¼–å†™è·å–é€»è¾‘ã€‚

å…¨å±€çŠ¶æ€ç®¡ç†èƒ½åŠ›å¯ä»¥è®© **æ‰€æœ‰é¡µé¢å…¨å±€å…±äº«å˜é‡**ï¼Œè€Œä¸æ˜¯å±€é™åœ¨æŸä¸€ä¸ªé¡µé¢ä¸­ã€‚WBpr9WI72APgOj+DCCZKObs+ofP0VhBHSvqSELGriv0=

å·²ç™»å½•ç”¨æˆ·ä¿¡æ¯å°±å¾ˆé€‚åˆä½œä¸ºå…¨â å±€çŠ¶æ€çš„æ•°æ®ï¼Œå› ä¸ºâ æ¯ä¸ªé¡µé¢å‡ ä¹éƒ½è¦ç”¨ã€‚

æ­¤å¤„æˆ‘ä»¬é€‰æ‹©ä¸»æµçš„çŠ¶æ€ç®¡ç†åº“ Piniaï¼Œç›¸æ¯”äº Vuex æ¥è¯´ä½¿ç”¨æ›´ç®€å•ï¼Œå¯å‚è€ƒ [å…¥é—¨æ–‡æ¡£](https://pinia.vuejs.org/zh/getting-started.html) è¿›è¡Œå¼•å…¥ã€‚

#### 1ã€å¼•å…¥ Pinia

æ­¤å¤„ç”±äºåˆ›å»ºé¡¹ç›®æ—¶ä½¿ç”¨çš„ `create-vue` è„šæ‰‹æ¶å·²ç»å¸®æˆ‘ä»¬æ•´åˆäº† Piniaï¼Œæ— éœ€æ‰‹åŠ¨å¼•å…¥ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚

#### 2ã€å®šä¹‰çŠ¶æ€

åœ¨ src/stores ç›®å½•ä¸‹æ–°å»º `loginUser.ts` æ–‡ä»¶ï¼Œå®šä¹‰äº†ç™»å½•ç”¨æˆ·çš„å­˜å‚¨ã€è¿œç¨‹è·å–ã€ä¿®æ”¹é€»è¾‘ï¼šnShO7+0zZStNyiJdnnoFDwT4JyyptzNsRjyXLsolAAU=

```typescript
import { defineStore } from 'pinia'
import { ref } from 'vue'
import { getLoginUser } from '@/api/userController.ts'

export const useLoginUserStore = defineStore('loginUser', () => {
  // é»˜è®¤å€¼
  const loginUser = ref<API.LoginUserVO>({
    userName: 'æœªç™»å½•',
  })

  // è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯
  async function fetchLoginUser() {
    const res = await getLoginUser()
    if (res.data.code === 0 && res.data.data) {
      loginUser.value = res.data.data
    }
  }
  // æ›´æ–°ç™»å½•ç”¨æˆ·ä¿¡æ¯
  function setLoginUser(newLoginUser: any) {
    loginUser.value = newLoginUser
  }

  return { loginUser, setLoginUser, fetchLoginUser }
})
```

#### 3ã€ä½¿ç”¨çŠ¶æ€

å¯ä»¥ç›´æ¥ä½¿ç”¨ store ä¸­å¯¼å‡ºçš„çŠ¶æ€å˜é‡å’Œå‡½æ•°ã€‚EVevk6+j/BC/ssKO5aUZF8Rusnkp1o/HghJkPkRChGQ=

åœ¨é¦–æ¬¡è¿›å…¥åˆ°é¡µé¢æ—¶ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå°è¯•è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯ã€‚æ‰€ä»¥ä¿®æ”¹å…¥å£æ–‡ä»¶ `App.vue`ï¼Œç¼–å†™è¿œç¨‹è·å–æ•°æ®ä»£ç ï¼š

```typescript
import { useLoginUserStore } from '@/stores/loginUser.ts'

const loginUserStore = useLoginUserStore()
loginUserStore.fetchLoginUser()
```

åœ¨ä»»ä½•é¡µé¢ä¸­éƒ½å¯ä»¥ä½¿ç”¨æ•°æ®ï¼Œâ æ¯”å¦‚ Globalâ Header å…¨å±€é¡¶éƒ¨æ ç»„ä»¶ä¸­ç›´æ¥å±•ç¤ºï¼šqo3wYiJtEuojZDmpW2HRDEwGWUH1DzVFQ47Zs4YmYuk=

```typescript
// HTML å±•ç¤ºæ•°æ®
{{ JSON.stringify(loginUserStore.loginUser) }}

// JS ä¸­å¼•å…¥ Store
import { useLoginUserStore } from '@/stores/loginUser.ts'
const loginUserStore = useLoginUserStore()
```

ä¿®æ”¹å…¨å±€é¡¶éƒ¨æ ç»„ä»¶ï¼Œåœ¨å³ä¾§å±•ç¤ºç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼š

```vue
<div class="user-login-status">
  <div v-if="loginUserStore.loginUser.id">
    <a-space>
      <a-avatar :src="loginUserStore.loginUser.userAvatar" />
      {{ loginUserStore.loginUser.userName ?? 'æ— å' }}
    </a-space>
  </div>
  <div v-else>
    <a-button type="primary" href="/user/login">ç™»å½•</a-button>
  </div>
</div>
```

æ•ˆæœå¦‚å›¾ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/gJohZwp8bx5kV7ib.webp)

### ç”¨æˆ·ç™»å½•é¡µé¢

å¼€å‘ UserLoginPage.vueï¼Œå¯ä»¥åŸºäº [Ant Design Vue çš„è¡¨å•ç»„ä»¶](https://antdv.com/components/form-cn#components-form-demo-normal-login) å¿«é€Ÿå¼€å‘ç™»å½•é¡µé¢ã€‚

å…ˆå¼€å‘åŸºç¡€é¡µé¢ï¼Œå¯ä»¥æŒ‰ç…§éœ€è¦å¢åŠ ä¸€äº›å‰ç«¯æ ¡éªŒï¼Œä»£ç å¦‚ä¸‹ï¼š

```vue
<template>
  <div id="userLoginPage">
    <h2 class="title">é±¼çš® AI åº”ç”¨ç”Ÿæˆ - ç”¨æˆ·ç™»å½•</h2>
    <div class="desc">ä¸å†™ä¸€è¡Œä»£ç ï¼Œç”Ÿæˆå®Œæ•´åº”ç”¨</div>
    <a-form :model="formState" name="basic" autocomplete="off" @finish="handleSubmit">
      <a-form-item name="userAccount" :rules="[{ required: true, message: 'è¯·è¾“å…¥è´¦å·' }]">
        <a-input v-model:value="formState.userAccount" placeholder="è¯·è¾“å…¥è´¦å·" />
      </a-form-item>
      <a-form-item
        name="userPassword"
        :rules="[
          { required: true, message: 'è¯·è¾“å…¥å¯†ç ' },
          { min: 8, message: 'å¯†ç ä¸èƒ½å°äº 8 ä½' },
        ]"
      >
        <a-input-password v-model:value="formState.userPassword" placeholder="è¯·è¾“å…¥å¯†ç " />
      </a-form-item>
      <div class="tips">
        æ²¡æœ‰è´¦å·ï¼Ÿ
        <RouterLink to="/user/register">å»æ³¨å†Œ</RouterLink>
      </div>
      <a-form-item>
        <a-button type="primary" html-type="submit" style="width: 100%">ç™»å½•</a-button>
      </a-form-item>
    </a-form>
  </div>
</template>
```

å®šä¹‰ä¸€ä¸ªå“åº”å¼å˜é‡æ¥æ¥å—è¡¨å•â è¾“å…¥çš„å€¼ï¼Œå½“è¿™ä¸ªå€¼â æ”¹å˜æ—¶ï¼Œé¡µé¢å±•ç¤ºçš„å…ƒç´ ä¹Ÿä¼šè¿›è¡Œæ›´æ–°ï¼š

```typescript
const formState = reactive<API.UserLoginRequest>({
  userAccount: '',
  userPassword: '',
})
```

ç¼–å†™ CSS æ ·å¼ï¼Œç¾åŒ–é¡µé¢ï¼š1vM0bC71h2RCfUkazMGszlP9tIpAZTvdkFrdc8O6/+w=

```css
#userLoginPage {
  max-width: 360px;
  margin: 0 auto;
}

.title {
  text-align: center;
  margin-bottom: 16px;
}

.desc {
  text-align: center;
  color: #bbb;
  margin-bottom: 16px;
}

.tips {
  margin-bottom: 16px;
  color: #bbb;
  font-size: 13px;
  text-align: right;
}
```

ç¼–å†™è¡¨å•æäº¤åæ‰§è¡Œçš„å‡½æ•°ï¼Œç™»é™†æˆåŠŸåéœ€è¦åœ¨â å…¨å±€çŠ¶æ€ä¸­è®°å½•å½“å‰ç™»å½•ç”¨æˆ·çš„â ä¿¡æ¯ï¼Œå¹¶è·³è½¬åˆ°ä¸»é¡µï¼šâ€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‰â€‰â€‰â€‰â€‰â€‚â€‰â€‰â€‰â€‰â€‚â€‚â€‚â€‰â€‚â€‚

```typescript
const router = useRouter()
const loginUserStore = useLoginUserStore()

/**
 * æäº¤è¡¨å•
 * @param values
 */
const handleSubmit = async (values: any) => {
  const res = await userLogin(values)
  // ç™»å½•æˆåŠŸï¼ŒæŠŠç™»å½•æ€ä¿å­˜åˆ°å…¨å±€çŠ¶æ€ä¸­
  if (res.data.code === 0 && res.data.data) {
    await loginUserStore.fetchLoginUser()
    message.success('ç™»å½•æˆåŠŸ')
    router.push({
      path: '/',
      replace: true,
    })
  } else {
    message.error('ç™»å½•å¤±è´¥ï¼Œ' + res.data.message)
  }
}
```

é¡µé¢æ•ˆæœå¦‚å›¾ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/nD9vR2DjNdNz7O03.webp)

### ç”¨æˆ·æ³¨å†Œé¡µé¢ - Vibe Coding

åŒæ ·ä½¿ç”¨è¡¨å•ç»„ä»¶ï¼Œåœ¨ç”¨æˆ·ç™»å½•â é¡µé¢çš„åŸºç¡€ä¸Šè°ƒæ•´å³â å¯ï¼Œæ¶‰åŠåˆ°æ›´å¤šè¡¨å•é¡¹çš„å¡«å†™ã€‚

è¿™æ¬¡ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ AI ç”Ÿæˆï¼Œè¾“å…¥æç¤ºè¯ï¼š

```markdown
è¯·ä»¿ç…§ç”¨æˆ·ç™»å½•é¡µé¢ @UserLoginPage.vue çš„æ ·å¼å’Œä»£ç é£æ ¼ï¼Œå¸®æˆ‘å®Œå–„ç”¨æˆ·æ³¨å†Œé¡µé¢ @UserRegisterPage.vue çš„ä»£ç ï¼Œè¯·æ±‚ä»£ç å’Œæ¥å£ä¿¡æ¯åœ¨ @/api ç›®å½•ä¸‹ã€‚è¦æ±‚æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚
```

æœ€å¥½åˆ©ç”¨ `@` å…³è”åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/ioZ88YWmXDer6jHU.webp)

ç”Ÿæˆçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼Œè¿™é‡Œæˆ‘æƒŠâ è®¶åœ°å‘ç°ç«Ÿç„¶è·Ÿæˆ‘ä¹‹â å‰è‡ªå·±æ‰‹å†™çš„ç¥ä¼¼ï¼F+kzRHG1248BgN91hBPqtNxbML3nLzvb0nw4jU7NTyI=

```vue
<template>
  <div id="userRegisterPage">
    <h2 class="title">é±¼çš® AI åº”ç”¨ç”Ÿæˆ - ç”¨æˆ·æ³¨å†Œ</h2>
    <div class="desc">ä¸å†™ä¸€è¡Œä»£ç ï¼Œç”Ÿæˆå®Œæ•´åº”ç”¨</div>
    <a-form :model="formState" name="basic" autocomplete="off" @finish="handleSubmit">
      <a-form-item name="userAccount" :rules="[{ required: true, message: 'è¯·è¾“å…¥è´¦å·' }]">
        <a-input v-model:value="formState.userAccount" placeholder="è¯·è¾“å…¥è´¦å·" />
      </a-form-item>
      <a-form-item
        name="userPassword"
        :rules="[
          { required: true, message: 'è¯·è¾“å…¥å¯†ç ' },
          { min: 8, message: 'å¯†ç ä¸èƒ½å°äº 8 ä½' },
        ]"
      >
        <a-input-password v-model:value="formState.userPassword" placeholder="è¯·è¾“å…¥å¯†ç " />
      </a-form-item>
      <a-form-item
        name="checkPassword"
        :rules="[
          { required: true, message: 'è¯·ç¡®è®¤å¯†ç ' },
          { min: 8, message: 'å¯†ç ä¸èƒ½å°äº 8 ä½' },
          { validator: validateCheckPassword },
        ]"
      >
        <a-input-password v-model:value="formState.checkPassword" placeholder="è¯·ç¡®è®¤å¯†ç " />
      </a-form-item>
      <div class="tips">
        å·²æœ‰è´¦å·ï¼Ÿ
        <RouterLink to="/user/login">å»ç™»å½•</RouterLink>
      </div>
      <a-form-item>
        <a-button type="primary" html-type="submit" style="width: 100%">æ³¨å†Œ</a-button>
      </a-form-item>
    </a-form>
  </div>
</template>

<script setup lang="ts">
import { useRouter } from 'vue-router'
import { userRegister } from '@/api/userController.ts'
import { message } from 'ant-design-vue'
import { reactive } from 'vue'

const router = useRouter()

const formState = reactive<API.UserRegisterRequest>({
  userAccount: '',
  userPassword: '',
  checkPassword: '',
})

/**
 * éªŒè¯ç¡®è®¤å¯†ç 
 * @param rule
 * @param value
 * @param callback
 */
const validateCheckPassword = (rule: unknown, value: string, callback: (error?: Error) => void) => {
  if (value && value !== formState.userPassword) {
    callback(new Error('ä¸¤æ¬¡è¾“å…¥å¯†ç ä¸ä¸€è‡´'))
  } else {
    callback()
  }
}

/**
 * æäº¤è¡¨å•
 * @param values
 */
const handleSubmit = async (values: API.UserRegisterRequest) => {
  const res = await userRegister(values)
  // æ³¨å†ŒæˆåŠŸï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
  if (res.data.code === 0) {
    message.success('æ³¨å†ŒæˆåŠŸ')
    router.push({
      path: '/user/login',
      replace: true,
    })
  } else {
    message.error('æ³¨å†Œå¤±è´¥ï¼Œ' + res.data.message)
  }
}
</script>

<style scoped>
#userRegisterPage {
  max-width: 360px;
  margin: 0 auto;
}

.title {
  text-align: center;
  margin-bottom: 16px;
}

.desc {
  text-align: center;
  color: #bbb;
  margin-bottom: 16px;
}

.tips {
  margin-bottom: 16px;
  color: #bbb;
  font-size: 13px;
  text-align: right;
}
</style>
```

é¡µé¢æ•ˆæœå¦‚å›¾ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/WBJjTL1V4yr8wncq.webp)nShO7+0zZStNyiJdnnoFDwT4JyyptzNsRjyXLsolAAU=

### ç”¨æˆ·æ³¨é”€

ä¸€èˆ¬é¼ æ ‡æ‚¬æµ®åœ¨å³ä¸Šè§’ç”¨æˆ·å¤´åƒâ æ—¶ï¼Œä¼šå±•ç¤ºåŒ…å«ç”¨æˆ·â æ³¨é”€ï¼ˆé€€å‡ºç™»å½•ï¼‰åŠŸèƒ½çš„ä¸‹æ‹‰èœå•ã€‚

å…ˆå¼€å‘é¡µé¢ç»“æ„ï¼š1vM0bC71h2RCfUkazMGszlP9tIpAZTvdkFrdc8O6/+w=

```vue
<div v-if="loginUserStore.loginUser.id">
  <a-dropdown>
    <a-space>
      <a-avatar :src="loginUserStore.loginUser.userAvatar" />
      {{ loginUserStore.loginUser.userName ?? 'æ— å' }}
    </a-space>
    <template #overlay>
      <a-menu>
        <a-menu-item @click="doLogout">
          <LogoutOutlined />
          é€€å‡ºç™»å½•
        </a-menu-item>
      </a-menu>
    </template>
  </a-dropdown>
</div>
```

ç¼–å†™ç”¨æˆ·æ³¨é”€äº‹ä»¶å‡½æ•°ï¼Œé€€å‡ºç™»å½•åè·³è½¬åˆ°ç™»å½•é¡µï¼š

```typescript
import { LogoutOutlined } from '@ant-design/icons-vue'

// ç”¨æˆ·æ³¨é”€
const doLogout = async () => {
  const res = await userLogout()
  if (res.data.code === 0) {
    loginUserStore.setLoginUser({
      userName: 'æœªç™»å½•',
    })
    message.success('é€€å‡ºç™»å½•æˆåŠŸ')
    await router.push('/user/login')
  } else {
    message.error('é€€å‡ºç™»å½•å¤±è´¥ï¼Œ' + res.data.message)
  }
}
```

æ•ˆæœå¦‚å›¾ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/RDgPy6ejN97MWtG0.webp)

### ç”¨æˆ·ç®¡ç†é¡µé¢

éœ€æ±‚ï¼šå…è®¸ç®¡ç†å‘˜æŸ¥çœ‹å·²æ³¨å†Œçš„â ç”¨æˆ·ä¿¡æ¯ï¼Œèƒ½å¤Ÿæ ¹æ®â ç”¨æˆ·åç§°æœç´¢ç”¨æˆ·ã€å¹¶åˆ é™¤éæ³•ç”¨æˆ·ã€‚

éœ€è¦æ³¨æ„ï¼Œè¦é˜²æ­¢æ™®é€šç”¨æˆ·ä¹Ÿèƒ½çœ‹â åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥è¦å¢â åŠ ä¸€å®šçš„æƒé™æ§åˆ¶ï¼Œå¯ä»¥åˆ†ä¸ºé¡µé¢å¼€å‘å’Œæƒé™æ§åˆ¶ä¸¤ä¸ªæ­¥éª¤æ¥å®ç°ã€‚

ç¼–å†™é¡µé¢ï¼šä¸Šæ–¹æœç´¢æ ï¼Œä¸‹æ–¹è¡¨æ ¼ï¼Œè¡¨æ ¼éœ€è¦æ”¯æŒåˆ†é¡µã€‚dWCTYpHEFA/xV8BrvOpKRqkO1d88b9Ip8VkvBeLuZho=

æˆ‘ä»¬å¯ä»¥æ‹†åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤æ¥å¼€å‘ï¼š

#### 1ã€è¡¨æ ¼

1ï¼‰åˆ©ç”¨ [Ant Design Vue çš„è¡¨æ ¼ç»„ä»¶](https://antdv.com/components/table-cn#components-table-demo-basic)ï¼Œæ‰¾åˆ°éœ€è¦çš„ç»„ä»¶è¿›è¡Œå¤åˆ¶ï¼Œå…ˆå±•ç¤ºå…¨éƒ¨ç”¨æˆ·ä¿¡æ¯ã€‚dWCTYpHEFA/xV8BrvOpKRqkO1d88b9Ip8VkvBeLuZho=

![](https://pic.code-nav.cn/course_picture/1608440217629360130/s17lP45J0OOoRlGI.webp)

2ï¼‰åªéœ€è¦æ ¹æ®è‡ªå·±çš„æ•°æ®è¡¨ï¼Œç¼–å†™ câ olumns è¡¨æ ¼åˆ—ï¼Œå¹¶â ä¼ å…¥è·å–åˆ°çš„ data æ•°æ®ï¼Œç»„ä»¶å°±èƒ½è‡ªåŠ¨å¸®æˆ‘ä»¬å±•ç¤ºå‡ºè¡¨æ ¼ï¼Œéå¸¸æ–¹ä¾¿ã€‚

å®šä¹‰è¡¨æ ¼åˆ—ï¼šdWCTYpHEFA/xV8BrvOpKRqkO1d88b9Ip8VkvBeLuZho=

```typescript
const columns = [
  {
    title: 'id',
    dataIndex: 'id',
  },
  {
    title: 'è´¦å·',
    dataIndex: 'userAccount',
  },
  {
    title: 'ç”¨æˆ·å',
    dataIndex: 'userName',
  },
  {
    title: 'å¤´åƒ',
    dataIndex: 'userAvatar',
  },
  {
    title: 'ç®€ä»‹',
    dataIndex: 'userProfile',
  },
  {
    title: 'ç”¨æˆ·è§’è‰²',
    dataIndex: 'userRole',
  },
  {
    title: 'åˆ›å»ºæ—¶é—´',
    dataIndex: 'createTime',
  },
  {
    title: 'æ“ä½œ',
    key: 'action',
  },
]
```

3ï¼‰ä»åç«¯è·å–æ•°æ®ï¼š

```typescript
// æ•°æ®
const data = ref<API.UserVO[]>([])
const total = ref(0)

// æœç´¢æ¡ä»¶
const searchParams = reactive<API.UserQueryRequest>({
  pageNum: 1,
  pageSize: 10,
})

// è·å–æ•°æ®
const fetchData = async () => {
  const res = await listUserVoByPage({
    ...searchParams,
  })
  if (res.data.data) {
    data.value = res.data.data.records ?? []
    total.value = res.data.data.totalRow ?? 0
  } else {
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)
  }
}

// é¡µé¢åŠ è½½æ—¶è¯·æ±‚ä¸€æ¬¡
onMounted(() => {
  fetchData()
})
```

æ³¨æ„ï¼Œä¸Šè¿°ä»£ç ä¸­ï¼Œä½¿ç”¨ onMâ ounted åŒ…è£¹è·â å–æ•°æ®çš„å‡½æ•°ï¼Œå¯ä»¥ä½¿å¾—åœ¨é¡µé¢åŠ è½½æ—¶ä»…å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œé¿å…é‡å¤è·å–ã€‚

è¿è¡Œé¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®è¢«æ­£å¸¸åŠ è½½ï¼Œä½†æ˜¯æ˜¾ç„¶å±•ç¤ºæ•ˆæœå¹¶ä¸å¥½ã€‚

![](https://pic.code-nav.cn/course_picture/1608440217629360130/ohZAaR2a9qWtprac.webp)F+kzRHG1248BgN91hBPqtNxbML3nLzvb0nw4jU7NTyI=

4ï¼‰å¯¹äºå›¾ç‰‡ã€ç”¨æˆ·è§’è‰²ã€åˆ›å»ºâ æ—¶é—´ã€æ›´æ–°æ—¶é—´ä¹‹ç±»â çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ›´å¥½çš„å±•ç¤ºæ–¹å¼ã€‚

è¡¨æ ¼ç»„ä»¶æ”¯æŒæˆ‘ä»¬ä½¿ç”¨ Vueâ  çš„æ’æ§½è‡ªå®šä¹‰åˆ—çš„â å±•ç¤ºï¼Œå‚è€ƒ Demo æœ‰æ ·å­¦æ ·ä¿®æ”¹å³å¯ã€‚

```tsx
<template #bodyCell="{ column, record }">
  <template v-if="column.dataIndex === 'userAvatar'">
    <a-image :src="record.userAvatar" :width="120" />
  </template>
  <template v-else-if="column.dataIndex === 'userRole'">
    <div v-if="record.userRole === 'admin'">
      <a-tag color="green">ç®¡ç†å‘˜</a-tag>
    </div>
    <div v-else>
      <a-tag color="blue">æ™®é€šç”¨æˆ·</a-tag>
    </div>
  </template>
  <template v-else-if="column.dataIndex === 'createTime'">
    {{ dayjs(record.createTime).format('YYYY-MM-DD HH:mm:ss') }}
  </template>
  <template v-else-if="column.key === 'action'">
    <a-button danger>åˆ é™¤</a-button>
  </template>
</template>
```

æ•ˆæœå¦‚å›¾ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/JgCtrqOd2chFapWF.webp)

#### 2ã€åˆ†é¡µ

1ï¼‰è¡¨æ ¼ç»„ä»¶ [æ”¯æŒåˆ†é¡µ](https://antdv.com/components/table-cn#pagination)ï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ªåˆ†é¡µå˜é‡ï¼ŒæŒ‡å®šå½“å‰é¡µå·ã€é¡µé¢å¤§å°ã€æ•°æ®æ€»æ•°ã€å±•ç¤ºæ€»æ•°çš„æ–‡æ¡ˆç­‰å‚æ•°ï¼š

```typescript
// åˆ†é¡µå‚æ•°
const pagination = computed(() => {
  return {
    current: searchParams.pageNum ?? 1,
    pageSize: searchParams.pageSize ?? 10,
    total: total.value,
    showSizeChanger: true,
    showTotal: (total: number) => `å…± ${total} æ¡`,
  }
})
```

æ³¨æ„ï¼Œç”±äºè¿™äº›å‚æ•°éƒ½æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œéœ€è¦ä½¿â ç”¨ Vue çš„ compuâ ted è®¡ç®—å±æ€§ï¼Œå¦åˆ™å½“ searchParams æ”¹å˜æ—¶ï¼Œåˆ†é¡µå‚æ•°å¹¶ä¸ä¼šæ›´æ–°ã€‚cZq9/nGwbRXl38gxWuOGAJfnulyo9Sx2vt9GhAJuMwQ=

2ï¼‰ç¼–å†™ doTableChangeâ  å‡½æ•°ï¼Œå½“ç”¨æˆ·åˆ‡æ¢é¡µå·å’Œâ é¡µé¢å¤§å°æ—¶ï¼Œéœ€è¦æ›´æ–° searchParams æœç´¢æ¡ä»¶çš„å€¼ï¼Œå¹¶è§¦å‘æœç´¢ï¼š

```typescript
// è¡¨æ ¼å˜åŒ–å¤„ç†
const doTableChange = (page: any) => {
  searchParams.pageNum = page.current
  searchParams.pageSize = page.pageSize
  fetchData()
}
```

3ï¼‰ç»™è¡¨æ ¼ç»„ä»¶ç»‘å®šåˆ†é¡µå‚æ•°å’Œè¡¨æ ¼åˆ‡æ¢äº‹ä»¶ï¼šEVevk6+j/BC/ssKO5aUZF8Rusnkp1o/HghJkPkRChGQ=

```tsx
<a-table
  :columns="columns"
  :data-source="data"
  :pagination="pagination"
  @change="doTableChange"
>
```

æ•ˆæœå¦‚å›¾ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/bfoi5xoxPocCuvXl.webp)p+CfRPZxNEuU7hG8dzfPcN4R10eC9eypGHmTaRf/x7c=

#### 3ã€æœç´¢

åˆ©ç”¨ [Ant Design Vue çš„æœç´¢ç»„ä»¶](https://antdv.com/components/input-cn#components-input-demo-search-input)ï¼Œå®ç°å¯¹æ•°æ®çš„æœç´¢ã€‚

1ï¼‰å…¶å®æœç´¢æœ¬è´¨ä¸Šå°±æ˜¯è®©ç”¨æˆ·â å¡«å†™æœç´¢æ¡ä»¶è¡¨å•ï¼Œâ æ­¤å¤„æˆ‘ä»¬éœ€è¦æ ¹æ®è´¦å·å’Œç”¨æˆ·æ˜µç§°æœç´¢ï¼Œç¼–å†™è¡¨å•ä»£ç ï¼šdWCTYpHEFA/xV8BrvOpKRqkO1d88b9Ip8VkvBeLuZho=

```tsx
<div id="userManagePage">
  <!-- æœç´¢è¡¨å• -->
  <a-form layout="inline" :model="searchParams" @finish="doSearch">
    <a-form-item label="è´¦å·">
      <a-input v-model:value="searchParams.userAccount" placeholder="è¾“å…¥è´¦å·" />
    </a-form-item>
    <a-form-item label="ç”¨æˆ·å">
      <a-input v-model:value="searchParams.userName" placeholder="è¾“å…¥ç”¨æˆ·å" />
    </a-form-item>
    <a-form-item>
      <a-button type="primary" html-type="submit">æœç´¢</a-button>
    </a-form-item>
  </a-form>
  <a-divider />
  <!-- è¡¨æ ¼ -->
</div>
```

ä½¿ç”¨ searchParams æ¥â å—ç”¨æˆ·çš„è¾“å…¥ï¼Œç›¸å½“äºæ‰€â æœ‰çš„æœç´¢æ¡ä»¶å…¨éƒ¨å­˜åˆ°äº† searchParams ä¸­ï¼Œä¾¿äºç»Ÿä¸€ç»´æŠ¤ã€‚

2ï¼‰ç‚¹å‡»æœç´¢æŒ‰é’®æ—¶ä¼šè§¦å‘è¡¨å•â æäº¤ï¼Œè¡¨å•æäº¤æ—¶éœ€â è¦å°†é¡µå·é‡ç½®ä¸º 1ï¼Œå¹¶è·å–æ•°æ®ã€‚ç¼–å†™å¯¹åº”çš„å‡½æ•°ï¼š1vM0bC71h2RCfUkazMGszlP9tIpAZTvdkFrdc8O6/+w=

```tsx
// è·å–æ•°æ®
const doSearch = () => {
  // é‡ç½®é¡µç 
  searchParams.pageNum = 1
  fetchData()
}
```

æ•ˆæœå¦‚å›¾ï¼Œå¯ä»¥éªŒè¯ä¸‹æœç´¢åŠŸèƒ½â ï¼šâ€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‰â€‰â€‰â€‰â€‰â€‚â€‰â€‰â€‰â€‰â€‚â€‚â€‚â€‰â€‚â€‚

![](https://pic.code-nav.cn/course_picture/1608440217629360130/EFsGwbdwm7OmL9bq.webp)UzapLzatIvJJsWWs1pRz7879eXluI/+jA6d4qBCHuKE=

#### 4ã€æ“ä½œ

æ¯”å¦‚å¼€å‘åˆ é™¤åŠŸèƒ½ï¼Œå…ˆç¼–å†™ç‚¹å‡»åˆ â é™¤æŒ‰é’®åçš„å¤„ç†å‡½æ•°ï¼šâ â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‰â€‰â€‰â€‰â€‰â€‚â€‰â€‰â€‰â€‰â€‚â€‚â€‚â€‰â€‚â€‚

```typescript
// åˆ é™¤æ•°æ®
const doDelete = async (id: string) => {
  if (!id) {
    return
  }
  const res = await deleteUser({ id })
  if (res.data.code === 0) {
    message.success('åˆ é™¤æˆåŠŸ')
    // åˆ·æ–°æ•°æ®
    fetchData()
  } else {
    message.error('åˆ é™¤å¤±è´¥')
  }
}
```

ç„¶åç»™åˆ é™¤æŒ‰é’®ç»‘å®šäº‹ä»¶ï¼š

```tsx
<a-button danger @click="doDelete(record.id)">åˆ é™¤</a-button>
```

### ç”¨æˆ·æƒé™æ§åˆ¶

è™½ç„¶åç«¯è·å–ç”¨æˆ·åˆ—è¡¨çš„æ¥å£åšäº†æƒé™æ ¡éªŒï¼Œé˜²æ­¢éç®¡ç†å‘˜ç”¨æˆ·è·å–åˆ°ã€‚ä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿå®‰å…¨å’Œæå‡ç”¨æˆ·ä½“éªŒï¼Œ**å‰ç«¯ä¹Ÿéœ€è¦å¯¹æƒé™è¿›è¡Œæ§åˆ¶ã€‚**

æœ‰ 2 ç§å®ç°æ–¹å¼ï¼šå•é¡µé¢æ§åˆ¶æƒé™ï¼Œæˆ–è€…å…¨å±€æ§åˆ¶æƒé™ã€‚

æ€è·¯éƒ½æ˜¯ä¸€è‡´çš„ï¼Œåœ¨è¿›å…¥æŸä¸ªé¡µé¢æ—¶åˆ¤æ–­â ç”¨æˆ·æ˜¯å¦å…·æœ‰è¯¥é¡µé¢çš„æƒé™â ï¼Œæ— éæ˜¯æŠŠæƒé™æ ¡éªŒç›¸å…³çš„ä»£ç å†™åœ¨å•ä¸ªé¡µé¢å†…ï¼Œè¿˜æ˜¯å†™åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ç½¢äº†ã€‚nShO7+0zZStNyiJdnnoFDwT4JyyptzNsRjyXLsolAAU=

\*\*å»ºè®®ç¼–å†™ç‹¬ç«‹çš„å…¨å±€æƒé™æ§åˆ¶æ–‡ä»¶ã€‚\*\*å¯ä»¥åˆ©ç”¨ Vue Router çš„è·¯ç”±å®ˆå«å®ç°ï¼Œæ¯æ¬¡åˆ‡æ¢å¹¶è¿›å…¥é¡µé¢å‰ï¼Œéƒ½ä¼šæ£€æŸ¥ä¸€ä¸‹å½“å‰ç”¨æˆ·æ˜¯å¦å…·æœ‰ç‰¹å®šé¡µé¢çš„æƒé™ã€‚

åœ¨ src ä¸‹ç¼–å†™ access.ts æƒé™æ ¡éªŒæ–‡ä»¶ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰é€»è¾‘ï¼Œæ¯”å¦‚ç”¨é¡µé¢å‰ç¼€æ¥ç»Ÿä¸€åˆ¤æ–­ï¼š

```tsx
import { useLoginUserStore } from '@/stores/loginUser'
import { message } from 'ant-design-vue'
import router from '@/router'

// æ˜¯å¦ä¸ºé¦–æ¬¡è·å–ç™»å½•ç”¨æˆ·
let firstFetchLoginUser = true

/**
 * å…¨å±€æƒé™æ ¡éªŒ
 */
router.beforeEach(async (to, from, next) => {
  const loginUserStore = useLoginUserStore()
  let loginUser = loginUserStore.loginUser
  // ç¡®ä¿é¡µé¢åˆ·æ–°ï¼Œé¦–æ¬¡åŠ è½½æ—¶ï¼Œèƒ½å¤Ÿç­‰åç«¯è¿”å›ç”¨æˆ·ä¿¡æ¯åå†æ ¡éªŒæƒé™
  if (firstFetchLoginUser) {
    await loginUserStore.fetchLoginUser()
    loginUser = loginUserStore.loginUser
    firstFetchLoginUser = false
  }
  const toUrl = to.fullPath
  if (toUrl.startsWith('/admin')) {
    if (!loginUser || loginUser.userRole !== 'admin') {
      message.error('æ²¡æœ‰æƒé™')
      next(`/user/login?redirect=${to.fullPath}`)
      return
    }
  }
  next()
})
```

æ³¨æ„ï¼Œä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†ç¡®ä¿é¡µé¢åˆ·æ–°æ—¶ï¼Œä»åç«¯æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯åå†è¿›è¡Œæƒé™æ ¡éªŒï¼Œä½¿ç”¨â  await ç­‰å¾…åç«¯æ¥å£è¿”å›ï¼Œå¹¶é‡æ–°èµ‹å€¼ç»™ logiâ nUserã€‚åŒæ—¶ï¼Œä¸ºäº†é˜²æ­¢æ¯æ¬¡åˆ‡æ¢è·¯ç”±éƒ½ä»è¿œç¨‹è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå®šä¹‰äº† firstFetchLoginUser å˜é‡ï¼Œç”¨äºæ§åˆ¶åœ¨åˆ·æ–°é¡µé¢ååªä¼šè¯·æ±‚åç«¯ä¸€æ¬¡ã€‚

**ç”±äºåœ¨ access.ts ä¸­å·²ç»è·å–åˆ°äº†ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œå¯ä»¥ç§»é™¤æ‰ä¹‹å‰åœ¨ App.vue ä¸­è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯çš„é€»è¾‘ï¼Œé¿å…é‡å¤è¯·æ±‚ã€‚**

åœ¨ main.tsï¼ˆå…¨å±€å…¥å£æ–‡ä»¶ï¼‰ä¸­å¼•å…¥ï¼šF+kzRHG1248BgN91hBPqtNxbML3nLzvb0nw4jU7NTyI=

```tsx
import '@/access'
```

ç”¨ä¸€ä¸ªæœªç™»å½•çš„ç”¨æˆ·æ¥æµ‹è¯•ï¼Œå°â è¯•è®¿é—®ç”¨æˆ·ç®¡ç†é¡µé¢â ï¼Œä¼šæŠ¥æƒé™é”™è¯¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/dvA1bFLwEJIsMrzo.webp)p+CfRPZxNEuU7hG8dzfPcN4R10eC9eypGHmTaRf/x7c=

è™½ç„¶å·²ç»æ»¡è¶³äº†éœ€æ±‚ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜ï¼Œå…¶â å®ä¸åº”è¯¥çœ‹åˆ° â€œç”¨æˆ·ç®¡ç†â€ â èœå•ã€‚å› æ­¤æˆ‘ä»¬è¿˜è¦ä¿®æ”¹ GlobalHeader èœå•é¡¹é…ç½®ï¼Œæ ¹æ®æƒé™å†³å®šæ˜¯å¦å±•ç¤ºæŸäº›èœå•é¡¹ã€‚

ç¼–å†™ä¸€ä¸ªè¿‡æ»¤èœå•é¡¹çš„å‡½æ•°ï¼š

```typescript
// èœå•é…ç½®é¡¹
const originItems = [
  {
    key: '/',
    icon: () => h(HomeOutlined),
    label: 'ä¸»é¡µ',
    title: 'ä¸»é¡µ',
  },
  {
    key: '/admin/userManage',
    label: 'ç”¨æˆ·ç®¡ç†',
    title: 'ç”¨æˆ·ç®¡ç†',
  },
  {
    key: 'others',
    label: h('a', { href: 'https://www.codefather.cn', target: '_blank' }, 'ç¼–ç¨‹å¯¼èˆª'),
    title: 'ç¼–ç¨‹å¯¼èˆª',
  },
]

// è¿‡æ»¤èœå•é¡¹
const filterMenus = (menus = [] as MenuProps['items']) => {
  return menus?.filter((menu) => {
    const menuKey = menu?.key as string
    if (menuKey?.startsWith('/admin')) {
      const loginUser = loginUserStore.loginUser
      if (!loginUser || loginUser.userRole !== 'admin') {
        return false
      }
    }
    return true
  })
}

// å±•ç¤ºåœ¨èœå•çš„è·¯ç”±æ•°ç»„
const menuItems = computed<MenuProps['items']>(() => filterMenus(originItems))
```

æµ‹è¯•æ•ˆæœï¼Œæœªç™»å½•æ—¶ä¸ä¼šçœ‹åˆ° â€œç”¨æˆ·ç®¡ç†â€ èœå•ï¼š

![](https://pic.code-nav.cn/course_picture/1608440217629360130/oYg05zS4r1G6okGV.webp)

å·²ç™»å½•çš„ç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°èœå•ï¼šF+kzRHG1248BgN91hBPqtNxbML3nLzvb0nw4jU7NTyI=

![](https://pic.code-nav.cn/course_picture/1608440217629360130/fHVuK4ym6eAet9jy.webp)

### æ‰©å±•æ€è·¯

#### 1ã€ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯

1ï¼‰ç›®å‰çš„ç”¨æˆ·ç®¡ç†é¡µé¢è¿˜ä¸æ”¯æŒç¼–è¾‘åŠŸèƒ½ï¼Œå‰ç«¯å¯ä»¥åˆ©ç”¨ [ç»„ä»¶åº“æ–‡æ¡£](https://antdv.com/components/table-cn#components-table-demo-edit-row) çš„ç¼–è¾‘è¡Œèƒ½åŠ› + AI å¿«é€Ÿå®Œæˆã€‚

2ï¼‰ç›®å‰ç”¨æˆ·æ— æ³•ç¼–è¾‘ä¸ªäººçš„ä¿¡â æ¯ï¼Œå¯ä»¥åœ¨å³ä¸Šè§’å¢â åŠ  â€œä¸ªäººä¸­å¿ƒ / ä¸ªäººè®¾ç½®â€ï¼Œç‚¹å‡»åè¿›å…¥ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯çš„è¡¨å•ã€‚

#### 2ã€å…¨å±€æƒé™ç®¡ç†ï¼ˆæä¾›å®ç°æ–¹æ¡ˆï¼‰

åœ¨æœ¬èŠ‚ â€œç”¨æˆ·æƒé™æ§åˆ¶â€ éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ç§è¾ƒä¸ºç®€å•â çš„æ–¹å¼å®ç°ï¼Œä½†æ˜¯ï¼Œåç»­è¡¥å……é¡µé¢å’Œæƒé™â æ ¡éªŒé€»è¾‘æ—¶ï¼Œæˆ‘ä»¬è¦åŒæ—¶ä¿®æ”¹æƒé™ç®¡ç†æ–‡ä»¶å’Œå¯¼èˆªæ æ–‡ä»¶ï¼Œç›¸å½“äºç»´æŠ¤äº† 2 ä¸ªæ–‡ä»¶ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„åŠæ³•å‘¢ï¼Ÿ

éœ€æ±‚ï¼šèƒ½å¤Ÿé€šè¿‡ç»´æŠ¤ **ä¸€ä¸ªé…ç½®æ–‡ä»¶**ï¼Œçµæ´»é…ç½®æ¯ä¸ªé¡µé¢æ‰€éœ€è¦çš„ç”¨æˆ·æƒé™ï¼Œç”±å…¨å±€æƒé™ç®¡ç†ç³»ç»Ÿè‡ªåŠ¨æ ¡éªŒå’Œæ‹¦æˆªï¼Œè€Œä¸éœ€è¦åœ¨æ¯ä¸ªé¡µé¢ä¸­ç¼–å†™æƒé™æ ¡éªŒä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚æ­¤å¤–ï¼Œè¿˜èƒ½æ ¹æ®è¯¥é…ç½®æ–‡ä»¶è‡ªåŠ¨éšè—æ²¡æƒé™çš„èœå•é¡¹çš„å±•ç¤ºã€‚

å®ç°æ–¹æ¡ˆï¼šnShO7+0zZStNyiJdnnoFDwT4JyyptzNsRjyXLsolAAU=

1.  åœ¨è·¯ç”±é…ç½®æ–‡ä»¶ï¼Œåˆ©ç”¨ Vue Router çš„ meta é™„åŠ å‚æ•°ï¼Œå®šä¹‰æŸä¸ªè·¯ç”±çš„è®¿é—®æƒé™
2.  ä½¿ç”¨å…¨å±€è·¯ç”±ç›‘å¬å™¨ï¼Œæ¯æ¬¡è®¿é—®é¡µé¢æ—¶ï¼Œæ ¹æ®ç”¨æˆ·è¦è®¿é—®é¡µé¢çš„è·¯ç”±æƒé™ä¿¡æ¯ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰å¯¹åº”çš„è®¿é—®æƒé™ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„æ‹¦æˆªå¤„ç†ã€‚

éœ€è¦å…ˆè‡ªè¡Œæ–°å»º NoAuthâ  æ— æƒé™é¡µé¢ï¼Œå†…å®¹â éšä¾¿å†™ï¼Œæ¯”å¦‚æ˜¾ç¤º â€œä½ æ²¡æœ‰æƒé™â€ã€‚

æ–°å»º access ç›®å½•ï¼Œæ‰€â æœ‰æƒé™ç®¡ç†ç›¸å…³çš„ä»£â ç éƒ½æ”¾åœ¨è¯¥ç›®å½•ä¸‹ï¼Œæ¨¡å—åŒ–ã€‚åªè¦ä¸å¼•å…¥ï¼Œå°±ä¸ä¼šç”Ÿæ•ˆã€‚1vM0bC71h2RCfUkazMGszlP9tIpAZTvdkFrdc8O6/+w=

1ï¼‰å®šä¹‰æƒé™æšä¸¾æ–‡ä»¶ accessEnum.tsï¼š

```typescript
/**
 * æƒé™å®šä¹‰
 */
const ACCESS_ENUM = {
  NOT_LOGIN: "notLogin",
  USER: "user",
  ADMIN: "admin",
};

export default ACCESS_ENUM;
```

2ï¼‰ä¿®æ”¹è·¯ç”±é…ç½®æ–‡ä»¶ï¼Œåœ¨ meta ä¸­è¡¥å……éœ€è¦çš„æƒé™ï¼šp+CfRPZxNEuU7hG8dzfPcN4R10eC9eypGHmTaRf/x7c=

```typescript
{
  path: '/admin/userManage',
  name: 'adminUserManage',
  component: UserManagePage,
  meta: {
    access: ACCESS_ENUM.ADMIN,
  },
},
```

3ï¼‰ç¼–å†™é€šç”¨çš„æƒé™æ ¡éªŒæ–¹æ³•ã€‚

é—®ï¼šä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼ŸEVevk6+j/BC/ssKO5aUZF8Rusnkp1o/HghJkPkRChGQ=

ç­”ï¼šå› ä¸ºèœå•ç»„ä»¶ä¸­è¦åˆ¤æ–­æƒé™â æ¥è¿‡æ»¤å±•ç¤ºçš„èœå•é¡¹â ã€æƒé™æ‹¦æˆªä¹Ÿè¦ç”¨åˆ°æƒé™åˆ¤æ–­åŠŸèƒ½ï¼Œæ‰€ä»¥æŠ½ç¦»æˆå…¬å…±æ¨¡å—ã€‚

checkAccess.ts æ–‡ä»¶ï¼š

```typescript
import ACCESS_ENUM from "@/access/accessEnum";

/**
 * æ£€æŸ¥æƒé™ï¼ˆåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å…·æœ‰æŸä¸ªæƒé™ï¼‰
 * @param loginUser å½“å‰ç™»å½•ç”¨æˆ·
 * @param needAccess éœ€è¦æœ‰çš„æƒé™
 * @return boolean æœ‰æ— æƒé™
 */
const checkAccess = (loginUser: any, needAccess = ACCESS_ENUM.NOT_LOGIN) => {
  // è·å–å½“å‰ç™»å½•ç”¨æˆ·å…·æœ‰çš„æƒé™ï¼ˆå¦‚æœæ²¡æœ‰ loginUserï¼Œåˆ™è¡¨ç¤ºæœªç™»å½•ï¼‰
  const loginUserAccess = loginUser?.userRole ?? ACCESS_ENUM.NOT_LOGIN;
  if (needAccess === ACCESS_ENUM.NOT_LOGIN) {
    return true;
  }
  // å¦‚æœç”¨æˆ·ç™»å½•æ‰èƒ½è®¿é—®
  if (needAccess === ACCESS_ENUM.USER) {
    // å¦‚æœç”¨æˆ·æ²¡ç™»å½•ï¼Œé‚£ä¹ˆè¡¨ç¤ºæ— æƒé™
    if (loginUserAccess === ACCESS_ENUM.NOT_LOGIN) {
      return false;
    }
  }
  // å¦‚æœéœ€è¦ç®¡ç†å‘˜æƒé™
  if (needAccess === ACCESS_ENUM.ADMIN) {
    // å¦‚æœä¸ä¸ºç®¡ç†å‘˜ï¼Œè¡¨ç¤ºæ— æƒé™
    if (loginUserAccess !== ACCESS_ENUM.ADMIN) {
      return false;
    }
  }
  return true;
};

export default checkAccess;
```

4ï¼‰ç¼–å†™å…¨å±€æƒé™æ ¡éªŒæ ¸å¿ƒæ–‡ä»¶ `access/index.ts`ã€‚

é€»è¾‘å¦‚ä¸‹ï¼š

1.  é¦–å…ˆåˆ¤æ–­é¡µé¢æ˜¯å¦éœ€è¦ç™»å½•æƒé™ï¼Œå¦‚æœä¸éœ€è¦ï¼Œç›´æ¥æ”¾è¡Œã€‚
    
2.  å¦‚æœé¡µé¢éœ€è¦ç™»å½•æƒé™
    
3.  å¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œåˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚
    
4.  å¦‚æœå·²ç™»å½•ï¼Œåˆ¤æ–­ç™»å½•ç”¨æˆ·çš„æƒé™æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œå¦åˆ™è·³è½¬åˆ° 401 æ— æƒé™é¡µé¢ã€‚
    

å®ç°ä»£ç å¦‚ä¸‹ï¼š

```typescript
import router from '@/router'
import { useLoginUserStore } from '@/stores/useLoginUserStore'
import ACCESS_ENUM from './accessEnum'
import checkAccess from './checkAccess'

router.beforeEach(async (to, from, next) => {
  const loginUserStore = useLoginUserStore()
  let loginUser = loginUserStore.loginUser
  console.log('ç™»é™†ç”¨æˆ·ä¿¡æ¯', loginUser)
  const needAccess = (to.meta?.access as string) ?? ACCESS_ENUM.NOT_LOGIN
  // è¦è·³è½¬çš„é¡µé¢å¿…é¡»è¦ç™»é™†
  if (needAccess !== ACCESS_ENUM.NOT_LOGIN) {
    // å¦‚æœæ²¡ç™»é™†ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
    if (!loginUser || !loginUser.userRole || loginUser.userRole === ACCESS_ENUM.NOT_LOGIN) {
      next(`/user/login?redirect=${to.fullPath}`)
      return
    }
    // å¦‚æœå·²ç»ç™»é™†äº†ï¼Œä½†æ˜¯æƒé™ä¸è¶³ï¼Œé‚£ä¹ˆè·³è½¬åˆ°æ— æƒé™é¡µé¢
    if (!checkAccess(loginUser, needAccess)) {
      next('/noAuth')
      return
    }
  }
  next()
})
```

æ³¨æ„ï¼Œå¿…é¡»ä¿è¯ pinia åˆå§‹åŒ–åœ¨è¿™æ®µä»£ç æ‰§è¡Œå‰ï¼Œæ‰€ä»¥éœ€è¦å°† `useLoginUserStore()` å‡½æ•°æ”¾åˆ° `router.beforeEach` å‚æ•°é‡Œã€‚å‚è€ƒæ–‡æ¡£ï¼š[https://pinia.vuejs.org/core-concepts/outside-component-usage.html](https://pinia.vuejs.org/core-concepts/outside-component-usage.html)dWCTYpHEFA/xV8BrvOpKRqkO1d88b9Ip8VkvBeLuZho=

åœ¨ main.ts ä¸­å¼•å…¥ï¼Œå³å¯ç”Ÿæ•ˆæƒé™æ ¡éªŒï¼š

```plain
import "@/access";
```

5ï¼‰æ”¯æŒå…¨å±€è‡ªåŠ¨ç™»å½•ã€‚å¦‚æœæ˜¯ **é¦–æ¬¡** è¿›å…¥é¡µé¢ï¼ŒçŠ¶æ€ä¸ºæœªç™»é™†ï¼Œåˆ™è‡ªåŠ¨ç™»å½•ã€‚F+kzRHG1248BgN91hBPqtNxbML3nLzvb0nw4jU7NTyI=

å¦‚ä½•åŒºåˆ«æ˜¯å¦ä¸ºé¦–æ¬¡è¿›å…¥é¡µé¢ï¼ˆè¿˜æ²¡å°è¯•è¿‡è·å–ç™»å½•ç”¨æˆ·ï¼‰å‘¢ï¼Ÿ

é»˜è®¤çš„ loginUser æ˜¯æ²¡æœ‰ usâ erRole çš„ï¼Œåªè¦è·å–â è¿‡ï¼Œå“ªæ€•æœªç™»å½•ï¼Œä¹Ÿå¯ä»¥ç»™è®¾ç½®ä¸€ä¸ª userRole ä¸º "notLogin"ã€‚

åœ¨ `access/index.ts` å¼€å¤´è¡¥å……è‡ªåŠ¨ç™»å½•é€»è¾‘qo3wYiJtEuojZDmpW2HRDEwGWUH1DzVFQ47Zs4YmYuk=

```typescript
// // å¦‚æœä¹‹å‰æ²¡ç™»é™†è¿‡ï¼Œè‡ªåŠ¨ç™»å½•
if (!loginUser || !loginUser.userRole) {
  // åŠ  await æ˜¯ä¸ºäº†ç­‰ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œå†æ‰§è¡Œåç»­çš„ä»£ç 
  await loginUserStore.fetchLoginUser();
  loginUser = loginUserStore.loginUser;
}
```

ä¹‹åè®°å¾—ç§»é™¤ App.vue ä¸­è·å–ç™»å½•ä¿¡æ¯çš„è°ƒç”¨ã€‚

6ï¼‰æ ¹æ®æƒé™æ§åˆ¶èœå•æ˜¾éšã€‚qo3wYiJtEuojZDmpW2HRDEwGWUH1DzVFQ47Zs4YmYuk=

éœ€æ±‚ï¼šåªæœ‰å…·æœ‰æƒé™çš„èœå•ï¼Œæ‰å¯¹ç”¨æˆ·å¯è§

åŸç†ï¼š

1.  éå†åŸèœå•é¡¹åˆ—è¡¨ï¼Œé’ˆå¯¹èœå• key å¯¹åº”çš„ path è·¯å¾„ï¼Œæ‰¾åˆ°è·¯ç”±ä¸­å¯¹åº”çš„ meta æƒé™é…ç½®ã€‚åªè¦åˆ¤æ–­ç”¨æˆ·æ²¡æœ‰è¿™ä¸ªæƒé™ï¼Œå°±ç›´æ¥è¿‡æ»¤æ‰ã€‚
2.  è¿˜å¯ä»¥é€šè¿‡åœ¨è·¯ç”±é…ç½®çš„ meta ä¸­æ·»åŠ  hideInMenuï¼Œçµæ´»æ§åˆ¶èœå•çš„æ˜¾éšã€‚

ä¿®æ”¹ GlobalHeadeâ r å…¨å±€å¯¼èˆªæ ï¼ˆé€šâ ç”¨èœå•ï¼‰ç»„ä»¶ï¼Œè¡¥å……æ ¹æ®æƒé™æ¥è¿‡æ»¤èœå•çš„é€»è¾‘ï¼Œå¯è‡ªè¡Œå®ç°ã€‚

```typescript
// è¿‡æ»¤èœå•é¡¹
const items = menus.filter((menu) => {
  // todo éœ€è¦è‡ªå·±å®ç° menu åˆ°è·¯ç”± item çš„è½¬åŒ–
  const item = menuToRouteItem(menu);
  if (item.meta?.hideInMenu) {
    return false;
  }
  // æ ¹æ®æƒé™è¿‡æ»¤èœå•ï¼Œæœ‰æƒé™åˆ™è¿”å› trueï¼Œåˆ™ä¿ç•™è¯¥èœå•
  return checkAccess(loginUserStore.loginUser, item.meta?.access as string);
});
```

cZq9/nGwbRXl38gxWuOGAJfnulyo9Sx2vt9GhAJuMwQ=
