
# AI 零代码应用生成项目中，如何为 AI 对话接口实现限流？解释一下原理？

我为 AI 对话这个核心且高成本的接口设计了一套基于 Redisson 的分布式限流方案，防止恶意请求和资源滥用。

首先我创建了一个自定义的 `@RateLimit` 注解，可以方便地标记在需要限流的 Controller 方法上。这个注解允许开发者灵活配置限流规则，比如限流的 key、速率、时间窗口以及限流类型。

通过 Spring AOP，我编写了一个 `RateLimitAspect` 切面，它会拦截所有标记了 `@RateLimit` 注解的方法。在方法执行前，切面会执行核心的限流逻辑。切面会根据注解中定义的限流类型动态生成一个唯一的 Redis Key。比如，如果是用户级别限流，Key 会包含 `user:` 前缀和当前用户的 ID；如果是 IP 级别，则包含 `ip:` 前缀和客户端 IP 地址。

我的限流逻辑是基于 Redisson 提供的分布式限流器 `RRateLimiter` 实现的，底层采用了令牌桶算法。

令牌桶算法的原理如下：

1.  系统在 Redis 中为每个限流 Key 维护一个虚拟的、固定容量的令牌桶。
2.  系统会以一个恒定的速率向这个桶里放入令牌。
3.  每当一个请求到达时，它必须尝试从桶里获取一个令牌。
4.  如果桶里有足够的令牌，请求成功获取并被处理；如果桶里没有令牌了，说明请求过于频繁，该请求就会被拒绝，并抛出一个自定义的业务异常，提示用户请求过于频繁。

![](https://pic.code-nav.cn/mianshiya/question_picture/markdown/2KUFhcFY_202508221403812_mianshiya.png)

可以看这道面试题 [了解常见的限流算法和实现原理](https://www.mianshiya.com/question/1802901573531410433)。
