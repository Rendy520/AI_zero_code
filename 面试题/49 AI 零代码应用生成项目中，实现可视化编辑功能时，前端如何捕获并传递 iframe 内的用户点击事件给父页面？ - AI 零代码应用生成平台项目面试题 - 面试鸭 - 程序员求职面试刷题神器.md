
# AI 零代码应用生成项目中，实现可视化编辑功能时，前端如何捕获并传递 iframe 内的用户点击事件给父页面？

在可视化编辑功能中，前端利用动态脚本注入和 `postMessage` API 实现了跨窗口通信，捕获并传递 `iframe` 内的点击事件。

具体实现细节：

1）首先通过 Vite 的代理配置，保证主应用页面和 `iframe` 中加载的预览网站处于同源，这是动态注入脚本和通信的前提。

2）当用户点击进入编辑模式时，父页面会创建一个 JavaScript 脚本，并将其动态注入到 `iframe` 的 `document` 中。这个脚本是实现后续所有操作的核心。

3）被注入的脚本会在 `iframe` 内部的 `document` 上添加一个 `click` 事件监听器，并且是在捕获阶段进行监听。这样无论用户点击哪个具体元素，该事件都能被最外层的监听器捕获到。

4）当点击事件发生时，注入的脚本会阻止事件的默认行为和冒泡，然后收集被点击元素的相关信息，比如标签名 、ID、类名，以及一个通过遍历DOM树向上生成的唯一 CSS 选择器。

5）脚本将收集到的元素信息打包成一个对象，然后调用 `window.parent.postMessage(payload, '*')` 方法，这个方法将数据作为消息安全地发送给 `iframe` 的父窗口。

6）父页面会设置一个 `'message'` 事件的监听器。当接收到来自 `iframe` 特定类型的消息时，它会解析消息中的数据，并更新自己的状态，得知用户在 `iframe` 中选中了哪个元素。
