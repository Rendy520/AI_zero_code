
# 给 AI 的文件写入工具是怎么实现的？如何确保每个应用的文件都写入到隔离的目录下？

文件写入工具 `FileWriteTool` 是我自定义的一个 LangChain4j 工具， AI 在执行代码生成任务时，将代码内容写入到服务器的指定文件中。

这个工具的核心是一个 `writeFile` 方法，使用了 `@Tool` 注解进行标记，LangChain4j 框架能够识别和调用。方法的参数也使用了 `@P` 注解加以描述，让 AI 理解如何正确传参。

为了知道文件应该写入哪个应用的目录，`writeFile` 方法的参数列表中包含了一个特殊的参数 `@ToolMemoryId Long appId`。这个注解是 LangChain4j 提供的上下文传参能力，它能将调用 AI Service 时指定的 `memoryId` 自动注入到工具方法中。

在方法内部，为了确保文件隔离，它首先会根据传入的 `appId` 构建一个唯一的项目根目录路径，格式为 `vue_project_{appId}`。所有的文件写入操作都被严格限制在这个目录内。

它接收 AI 传入的相对文件路径，并将其与上面构建的项目根目录进行拼接，得到一个绝对路径。然后，它会检查并创建所有必要的父目录，最后使用 `Files.write` 将内容写入文件。

为了防止泄露服务器的绝对路径，工具执行成功后，返回给 AI 和用户的信息中只包含相对路径，比如 “文件写入成功：src/App.vue”。
