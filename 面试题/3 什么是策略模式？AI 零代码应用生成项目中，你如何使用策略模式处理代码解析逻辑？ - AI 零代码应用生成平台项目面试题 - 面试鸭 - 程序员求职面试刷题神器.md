
# 什么是策略模式？AI 零代码应用生成项目中，你如何使用策略模式处理代码解析逻辑？

策略模式是一种行为设计模式，它定义了一系列算法，将每个算法都封装起来，并使它们可以相互替换。 这样做的核心优势是，算法的变化不会影响到使用算法的客户端代码，实现算法逻辑与客户端的解耦。

在我们的项目中，这个模式被用来优化 AI 生成代码后的解析逻辑。因为我们支持多种代码生成模式，每种模式 AI 返回的原始文本结构不同，因此需要不同的解析策略。

具体实现如下：

1）我们首先定义了一个统一的 `CodeParser<T>` 接口。 这个接口规范了所有代码解析器的行为，它包含一个核心的 `parseCode` 方法，负责接收 AI 生成的完整代码字符串并返回一个特定类型的结构化结果对象。泛型 `T` 可以让每种策略可以返回不同的结果类型。

2）实现具体策略：

-   `HtmlCodeParser`：实现了 `CodeParser<HtmlCodeResult>` 接口，专门负责从 AI 的回复中提取单个 HTML 代码块。
-   `MultiFileCodeParser`：实现了 `CodeParser<MultiFileCodeResult>` 接口，负责从 AI 的回复中分别提取 HTML、CSS 和 JavaScript 三个不同的代码块。

3）使用执行器进行调度：由于不同策略的返回值类型不同，直接使用传统的工厂模式来创建和调用会比较困难。所以我们引入了一个 `CodeParserExecutor`。这个执行器内部持有所有具体的策略实例，并提供一个统一的 `executeParser` 方法。该方法根据传入的 `CodeGenTypeEnum`，选择并执行对应的解析策略，对上层调用方屏蔽了内部的实现差异和复杂性。

这种执行器 + 策略模式的组合架构如下图所示：

![](https://pic.code-nav.cn/mianshiya/question_picture/markdown/gcG1r1RK_1755832760623-d8cce897-5b1b-4bc0-96f1-831a19138f6a_mianshiya.png)

这样我们的代码解析逻辑非常清晰、可维护性高。如果未来要支持新的代码生成模式，我们只需要新增一个对应的解析策略类，并在执行器中增加一个 case 分支即可，遵守对扩展开放，对修改关闭的设计原则。
